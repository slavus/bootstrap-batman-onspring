(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ba,bb=Array.prototype.slice,bc=Object.prototype.hasOwnProperty,bd=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},be=function(a,b){function d(){this.constructor=a}for(var c in b)bc.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},bf=function(a,b){return function(){return a.apply(b,arguments)}};B=function(){var a;a=1<=arguments.length?bb.call(arguments,0):[];return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(B.Object,a,function(){})},B.version="0.8.0",B.config={pathPrefix:"/",usePushState:!1},B.typeOf=x=function(a){if(typeof a=="undefined")return"Undefined";return Y.call(a).slice(8,-1)},Y=Object.prototype.toString,B.mixin=m=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=2<=arguments.length?bb.call(arguments,1):[],a=typeof e.set=="function";for(g=0,h=d.length;g<h;g++){c=d[g];if(x(c)!=="Object")continue;for(b in c){if(!bc.call(c,b))continue;f=c[b];if(b==="initialize"||b==="uninitialize"||b==="prototype")continue;a?e.set(b,f):e.nodeName!=null?B.data(e,b,f):e[b]=f}typeof c.initialize=="function"&&c.initialize.call(e)}return e},B.unmixin=A=function(){var a,b,c,d,e,f;a=arguments[0],d=2<=arguments.length?bb.call(arguments,1):[];for(e=0,f=d.length;e<f;e++){c=d[e];for(b in c){if(b==="initialize"||b==="uninitialize")continue;delete a[b]}typeof c.uninitialize=="function"&&c.uninitialize.call(a)}return a},B._functionName=h=function(a){var b;if(a.__name__)return a.__name__;if(a.name)return a.name;return(b=a.toString().match(/\W*function\s+([\w\$]+)\(/))!=null?b[1]:void 0},B._preventDefault=p=function(a){return typeof a.preventDefault=="function"?a.preventDefault():a.returnValue=!1},B._isChildOf=l=function(a,b){var c;c=b.parentNode;while(c){if(c===a)return!0;c=c.parentNode}return!1},t=c=null,U=function(a){var b,d,e,f,g,h,i;b=function(){var b,c;if(!a.postMessage)return!1;b=!0,c=a.onmessage,a.onmessage=function(){return b=!1},a.postMessage("","*"),a.onmessage=c;return b},i=new B.SimpleHash,d=0,f=function(){return"go"+ ++d},a.setImmediate?(t=a.setImmediate,c=a.clearImmediate):a.msSetImmediate?(t=msSetImmediate,c=msClearImmediate):b()?(h="com.batman.",e=new B.SimpleHash,g=function(a){var b,c;if(!!~a.data.search(h)){b=a.data.substring(h.length);return typeof (c=i.unset(b))=="function"?c():void 0}},a.addEventListener?a.addEventListener("message",g,!1):a.attachEvent("onmessage",g),t=function(b){var c;i.set(c=f(),b),a.postMessage(h+c,"*");return c},c=function(a){return i.unset(a)}):typeof document!="undefined"&&bd.call(document.createElement("script"),"onreadystatechange")>=0?(t=function(a){var b,c;b=f(),c=document.createElement("script"),c.onreadystatechange=function(){var a;typeof (a=i.get(b))=="function"&&a(),c.onreadystatechange=null,c.parentNode.removeChild(c);return c=null},document.documentElement.appendChild(c);return b},c=function(a){return i.unset(a)}):(t=function(a){return setTimeout(a,0)},c=function(a){return clearTimeout(a)}),B.setImmediate=t;return B.clearImmediate=c},B.setImmediate=t=function(){U(B.container);return B.setImmediate.apply(this,arguments)},B.clearImmediate=c=function(){U(B.container);return B.clearImmediate.apply(this,arguments)},B.forEach=f=function(a,b,c){var d,e,f,g,h,i,j;if(a.forEach)return a.forEach(b,c);if(a.indexOf){i=[];for(e=0,h=a.length;e<h;e++)d=a[e],i.push(b.call(c,d,e,a));return i}j=[];for(f in a)g=a[f],j.push(b.call(c,f,g,a));return j},B.objectHasKey=n=function(a,b){return typeof a.hasKey=="function"?a.hasKey(b):b in a},B.contains=d=function(a,b){return a.indexOf?bd.call(a,b)>=0:typeof a.has=="function"?a.has(b):n(a,b)},B.get=i=function(a,b){return typeof a.get=="function"?a.get(b):B.Property.forBaseAndKey(a,b).getValue()},B.translate=function(a,b){b==null&&(b={});return K.interpolate(i(B.translate.messages,a),b)},B.translate.messages={},O=function(){return B.translate.apply(B,arguments)},B.Inflector=function(){function a(){}a.prototype.plural=[],a.prototype.singular=[],a.prototype.uncountable=[],a.plural=function(a,b){return this.prototype.plural.unshift([a,b])},a.singular=function(a,b){return this.prototype.singular.unshift([a,b])},a.irregular=function(a,b){if(a.charAt(0)===b.charAt(0)){this.plural(new RegExp("("+a.charAt(0)+")"+a.slice(1)+"$","i"),"$1"+b.slice(1)),this.plural(new RegExp("("+a.charAt(0)+")"+b.slice(1)+"$","i"),"$1"+b.slice(1));return this.singular(new RegExp("("+b.charAt(0)+")"+b.slice(1)+"$","i"),"$1"+a.slice(1))}this.plural(new RegExp(""+a+"$","i"),b),this.plural(new RegExp(""+b+"$","i"),b);return this.singular(new RegExp(""+b+"$","i"),a)},a.uncountable=function(){var a;a=1<=arguments.length?bb.call(arguments,0):[];return this.prototype.uncountable=this.prototype.uncountable.concat(a.map(function(a){return new RegExp(""+a+"$","i")}))},a.plural(/$/,"s"),a.plural(/s$/i,"s"),a.plural(/(ax|test)is$/i,"$1es"),a.plural(/(octop|vir)us$/i,"$1i"),a.plural(/(octop|vir)i$/i,"$1i"),a.plural(/(alias|status)$/i,"$1es"),a.plural(/(bu)s$/i,"$1ses"),a.plural(/(buffal|tomat)o$/i,"$1oes"),a.plural(/([ti])um$/i,"$1a"),a.plural(/([ti])a$/i,"$1a"),a.plural(/sis$/i,"ses"),a.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),a.plural(/(hive)$/i,"$1s"),a.plural(/([^aeiouy]|qu)y$/i,"$1ies"),a.plural(/(x|ch|ss|sh)$/i,"$1es"),a.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),a.plural(/([m|l])ouse$/i,"$1ice"),a.plural(/([m|l])ice$/i,"$1ice"),a.plural(/^(ox)$/i,"$1en"),a.plural(/^(oxen)$/i,"$1"),a.plural(/(quiz)$/i,"$1zes"),a.singular(/s$/i,""),a.singular(/(n)ews$/i,"$1ews"),a.singular(/([ti])a$/i,"$1um"),a.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),a.singular(/(^analy)ses$/i,"$1sis"),a.singular(/([^f])ves$/i,"$1fe"),a.singular(/(hive)s$/i,"$1"),a.singular(/(tive)s$/i,"$1"),a.singular(/([lr])ves$/i,"$1f"),a.singular(/([^aeiouy]|qu)ies$/i,"$1y"),a.singular(/(s)eries$/i,"$1eries"),a.singular(/(m)ovies$/i,"$1ovie"),a.singular(/(x|ch|ss|sh)es$/i,"$1"),a.singular(/([m|l])ice$/i,"$1ouse"),a.singular(/(bus)es$/i,"$1"),a.singular(/(o)es$/i,"$1"),a.singular(/(shoe)s$/i,"$1"),a.singular(/(cris|ax|test)es$/i,"$1is"),a.singular(/(octop|vir)i$/i,"$1us"),a.singular(/(alias|status)es$/i,"$1"),a.singular(/^(ox)en/i,"$1"),a.singular(/(vert|ind)ices$/i,"$1ex"),a.singular(/(matr)ices$/i,"$1ix"),a.singular(/(quiz)zes$/i,"$1"),a.singular(/(database)s$/i,"$1"),a.irregular("person","people"),a.irregular("man","men"),a.irregular("child","children"),a.irregular("sex","sexes"),a.irregular("move","moves"),a.irregular("cow","kine"),a.irregular("zombie","zombies"),a.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans"),a.prototype.ordinalize=function(a){var b,c;b=Math.abs(parseInt(a));if(c=b%100,bd.call([11,12,13],c)>=0)return a+"th";switch(b%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd";default:return a+"th"}},a.prototype.pluralize=function(a){var b,c,d,e,f,g,h,i,j,k;i=this.uncountable;for(e=0,g=i.length;e<g;e++){d=i[e];if(d.test(a))return a}j=this.plural;for(f=0,h=j.length;f<h;f++){k=j[f],b=k[0],c=k[1];if(b.test(a))return a.replace(b,c)}return a},a.prototype.singularize=function(a){var b,c,d,e,f,g,h,i,j,k;i=this.uncountable;for(e=0,g=i.length;e<g;e++){d=i[e];if(d.test(a))return a}j=this.singular;for(f=0,h=j.length;f<h;f++){k=j[f],b=k[0],c=k[1];if(b.test(a))return a.replace(b,c)}return a};return a}(),G=/(?:^|_|\-)(.)/g,H=/(^|\s)([a-z])/g,P=/([A-Z]+)([A-Z][a-z])/g,Q=/([a-z\d])([A-Z])/g,K=B.helpers={inflector:new B.Inflector,ordinalize:function(){return K.inflector.ordinalize.apply(K.inflector,arguments)},singularize:function(){return K.inflector.singularize.apply(K.inflector,arguments)},pluralize:function(a,b,c){return arguments.length<2?K.inflector.pluralize(a):""+(a||0)+" "+(+a===1?b:c||K.inflector.pluralize(b))},camelize:function(a,b){a=a.replace(G,function(a,b){return b.toUpperCase()});return b?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(P,"$1_$2").replace(Q,"$1_$2").replace("-","_").toLowerCase()},capitalize:function(a){return a.replace(H,function(a,b,c){return b+c.toUpperCase()})},trim:function(a){return a?a.trim():""},interpolate:function(a,b){var c,d,e;typeof a=="object"?(d=a[b.count],d||(d=a.other)):d=a;for(c in b)e=b[c],d=d.replace(new RegExp("%\\{"+c+"\\}","g"),e);return d}},B.Event=function(){function a(a,b){this.base=a,this.key=b,this.handlers=new B.SimpleSet,this._preventCount=0}a.forBaseAndKey=function(a,b){return a.isEventEmitter?a.event(b):new B.Event(a,b)},a.prototype.isEvent=!0,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;this.hashKey=function(){return a};return a="<Batman.Event base: "+B.Hash.prototype.hashKeyFor(this.base)+', key: "'+B.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.addHandler=function(a){this.handlers.add(a),this.oneShot&&this.autofireHandler(a);return this},a.prototype.removeHandler=function(a){this.handlers.remove(a);return this},a.prototype.eachHandler=function(a){var b,c;this.handlers.forEach(a);if((c=this.base)!=null?c.isEventEmitter:void 0){b=this.key;return this.base._batman.ancestors(function(c){var d;if(c.isEventEmitter&&c.hasEvent(b)){d=c.event(b).handlers;return d.forEach(a)}})}},a.prototype.handlerContext=function(){return this.base},a.prototype.prevent=function(){return++this._preventCount},a.prototype.allow=function(){this._preventCount&&--this._preventCount;return this._preventCount},a.prototype.isPrevented=function(){return this._preventCount>0},a.prototype.autofireHandler=function(a){if(this._oneShotFired&&this._oneShotArgs!=null)return a.apply(this.handlerContext(),this._oneShotArgs)},a.prototype.resetOneShot=function(){this._oneShotFired=!1;return this._oneShotArgs=null},a.prototype.fire=function(){var a,b;if(this.isPrevented()||this._oneShotFired)return!1;b=this.handlerContext(),a=arguments,this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=arguments);return this.eachHandler(function(c){return c.apply(b,a)})},a.prototype.allowAndFire=function(){this.allow();return this.fire.apply(this,arguments)};return a}(),B.EventEmitter={isEventEmitter:!0,hasEvent:function(a){var b,c;return(b=this._batman)!=null?typeof b.get=="function"?(c=b.get("events"))!=null?c.hasKey(a):void 0:void 0:void 0},event:function(a){var b,c,d,e,f,g,h;B.initializeObject(this),b=this.eventClass||B.Event,c=(g=this._batman).events||(g.events=new B.SimpleHash);if(c.hasKey(a))return d=c.get(a);e=this._batman.get("events"),f=c.set(a,new b(this,a)),f.oneShot=e!=null?(h=e.get(a))!=null?h.oneShot:void 0:void 0;return f},on:function(a,b){return this.event(a).addHandler(b)},registerAsMutableSource:function(){return B.Property.registerSource(this)},mutation:function(a){return function(){var b;b=a.apply(this,arguments),this.event("change").fire(this,this);return b}},prevent:function(a){this.event(a).prevent();return this},allow:function(a){this.event(a).allow();return this},isPrevented:function(a){return this.event(a).isPrevented()},fire:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[];return(c=this.event(b)).fire.apply(c,a)},allowAndFire:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[];return(c=this.event(b)).allowAndFire.apply(c,a)}},B.PropertyEvent=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Event),a.prototype.eachHandler=function(a){return this.base.eachObserver(a)},a.prototype.handlerContext=function(){return this.base.base};return a}(),B.Property=function(){function a(a,b){this.base=a,this.key=b}m(a.prototype,B.EventEmitter),a._sourceTrackerStack=[],a.sourceTracker=function(){var a;return(a=this._sourceTrackerStack)[a.length-1]},a.defaultAccessor={get:function(a){return this[a]},set:function(a,b){return this[a]=b},unset:function(a){var b;b=this[a],delete this[a];return b},cachable:!1},a.forBaseAndKey=function(a,b){return a.isObservable?a.property(b):new B.Keypath(a,b)},a.withoutTracking=function(a){this.pushDummySourceTracker();try{return a()}finally{this.popSourceTracker()}},a.registerSource=function(a){var b;if(!!a.isEventEmitter)return(b=this.sourceTracker())!=null?b.add(a):void 0},a.pushSourceTracker=function(){return B.Property._sourceTrackerStack.push(new B.SimpleSet)},a.pushDummySourceTracker=function(){return B.Property._sourceTrackerStack.push(null)},a.popSourceTracker=function(){return B.Property._sourceTrackerStack.pop()},a.prototype._isolationCount=0,a.prototype.cached=!1,a.prototype.value=null,a.prototype.sources=null,a.prototype.isProperty=!0,a.prototype.isDead=!1,a.prototype.eventClass=B.PropertyEvent,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;this.hashKey=function(){return a};return a="<Batman.Property base: "+B.Hash.prototype.hashKeyFor(this.base)+', key: "'+B.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.changeEvent=function(){var a;a=this.event("change"),this.changeEvent=function(){return a};return a},a.prototype.accessor=function(){var a,b,c,d,e;b=(d=this.base._batman)!=null?d.get("keyAccessors"):void 0,a=b&&(c=b.get(this.key))?c:((e=this.base._batman)!=null?e.getFirst("defaultAccessor"):void 0)||B.Property.defaultAccessor,this.accessor=function(){return a};return a},a.prototype.eachObserver=function(a){var b;b=this.key,this.changeEvent().handlers.forEach(a);if(this.base.isObservable)return this.base._batman.ancestors(function(c){var d,e;if(c.isObservable&&c.hasProperty(b)){e=c.property(b),d=e.changeEvent().handlers;return d.forEach(a)}})},a.prototype.observers=function(){var a;a=[],this.eachObserver(function(b){return a.push(b)});return a},a.prototype.hasObservers=function(){return this.observers().length>0},a.prototype.updateSourcesFromTracker=function(){var a,b;b=this.constructor.popSourceTracker(),a=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(b){return b.removeHandler(a)}),this.sources=b;return this._eachSourceChangeEvent(function(b){return b.addHandler(a)})},a.prototype._eachSourceChangeEvent=function(a){if(this.sources!=null)return this.sources.forEach(function(b){return a(b.event("change"))})},a.prototype.getValue=function(){this.registerAsMutableSource();if(!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},a.prototype.isCachable=function(){var a;if(this.isFinal())return!0;a=this.accessor().cachable;return a!=null?!!a:!0},a.prototype.isCached=function(){return this.isCachable()&&this.cached},a.prototype.isFinal=function(){return!!this.accessor()["final"]},a.prototype.refresh=function(){var a,b;this.cached=!1,a=this.value,b=this.getValue(),b!==a&&!this.isIsolated()&&this.fire(b,a);if(this.value!==void 0&&this.isFinal())return this.lockValue()},a.prototype.sourceChangeHandler=function(){var a;a=bf(function(){return this._handleSourceChange()},this),this.sourceChangeHandler=function(){return a};return a},a.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:!this.isFinal()&&!this.hasObservers()?this.cached=!1:this.refresh()},a.prototype.valueFromAccessor=function(){var a;return(a=this.accessor().get)!=null?a.call(this.base,this.key):void 0},a.prototype.setValue=function(a){var b;if(!!(b=this.accessor().set))return this._changeValue(function(){return b.call(this.base,this.key,a)})},a.prototype.unsetValue=function(){var a;if(!!(a=this.accessor().unset))return this._changeValue(function(){return a.call(this.base,this.key)})},a.prototype._changeValue=function(a){var b;this.cached=!1,this.constructor.pushDummySourceTracker();try{b=a.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}!this.isCached()&&!this.hasObservers()&&this.die();return b},a.prototype.forget=function(a){return a!=null?this.changeEvent().removeHandler(a):this.changeEvent().handlers.clear()},a.prototype.observeAndFire=function(a){this.observe(a);return a.call(this.base,this.value,this.value)},a.prototype.observe=function(a){this.changeEvent().addHandler(a),this.sources==null&&this.getValue();return this},a.prototype._removeHandlers=function(){var a;a=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(b){return b.removeHandler(a)}),delete this.sources;return this.changeEvent().handlers.clear()},a.prototype.lockValue=function(){this._removeHandlers(),this.getValue=function(){return this.value};return this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},a.prototype.die=function(){var a,b;this._removeHandlers(),(a=this.base._batman)!=null&&(b=a.properties)!=null&&b.unset(this.key);return this.isDead=!0},a.prototype.fire=function(){var a;return(a=this.changeEvent()).fire.apply(a,arguments)},a.prototype.isolate=function(){this._isolationCount===0&&(this._preIsolationValue=this.getValue());return this._isolationCount++},a.prototype.expose=function(){if(this._isolationCount===1){this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue);return this._preIsolationValue=null}if(this._isolationCount>0)return this._isolationCount--},a.prototype.isIsolated=function(){return this._isolationCount>0};return a}(),B.Keypath=function(){function a(b,c){x(c)==="String"?(this.segments=c.split("."),this.depth=this.segments.length):(this.segments=[c],this.depth=1),a.__super__.constructor.apply(this,arguments)}be(a,B.Property),a.prototype.slice=function(a,b){var c,d,e,f,g,h,j,k;b==null&&(b=this.depth),c=this.base,k=this.segments.slice(0,a);for(h=0,j=k.length;h<j;h++){g=k[h];if(c==null||!(c=i(c,g)))return}d=c.propertyClass||B.Keypath,f=this.segments.slice(a,b),e=f.join(".");return d===B.Keypath||f.length===1?B.Keypath.forBaseAndKey(c,e):new B.Keypath(c,e)},a.prototype.terminalProperty=function(){return this.slice(-1)},a.prototype.valueFromAccessor=function(){var b;return this.depth===1?a.__super__.valueFromAccessor.apply(this,arguments):(b=this.terminalProperty())!=null?b.getValue():void 0},a.prototype.setValue=function(b){var c;return this.depth===1?a.__super__.setValue.apply(this,arguments):(c=this.terminalProperty())!=null?c.setValue(b):void 0},a.prototype.unsetValue=function(){var b;return this.depth===1?a.__super__.unsetValue.apply(this,arguments):(b=this.terminalProperty())!=null?b.unsetValue():void 0};return a}(),B.Observable={isObservable:!0,hasProperty:function(a){var b,c;return(b=this._batman)!=null?(c=b.properties)!=null?typeof c.hasKey=="function"?c.hasKey(a):void 0:void 0:void 0},property:function(a){var b,c,d;B.initializeObject(this),c=this.propertyClass||B.Keypath,b=(d=this._batman).properties||(d.properties=new B.SimpleHash);return b.get(a)||b.set(a,new c(this,a))},get:function(a){return this.property(a).getValue()},set:function(a,b){return this.property(a).setValue(b)},unset:function(a){return this.property(a).unsetValue()},getOrSet:function(a,b){var c;c=this.get(a),c||(c=b(),this.set(a,c));return c},forget:function(a,b){var c;a?this.property(a).forget(b):(c=this._batman.properties)!=null&&c.forEach(function(a,b){return b.forget()});return this},observe:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[],(c=this.property(b)).observe.apply(c,a);return this},observeAndFire:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[],(c=this.property(b)).observeAndFire.apply(c,a);return this}},B.initializeObject=function(a){return a._batman!=null?a._batman.check(a):a._batman=new R(a)},B._Batman=R=function(){function a(){var a,b;b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[],this.object=b,a.length>0&&m.apply(null,[this].concat(bb.call(a)))}a.prototype.check=function(b){if(b!==this.object){b._batman=new a(b);return!1}return!0},a.prototype.get=function(a){var b;b=this.getAll(a);switch(b.length){case 0:return;case 1:return b[0];default:b[0].concat!=null?b=b.reduceRight(function(a,b){return a.concat(b)}):b[0].merge!=null&&(b=b.reduceRight(function(a,b){return a.merge(b)}));return b}},a.prototype.getFirst=function(a){var b;b=this.getAll(a);return b[0]},a.prototype.getAll=function(a){var b,c,d;typeof a=="function"?b=a:b=function(b){var c;return(c=b._batman)!=null?c[a]:void 0},c=this.ancestors(b),(d=b(this.object))&&c.unshift(d);return c},a.prototype.ancestors=function(a){var b,c,d,e,f,g,h;a==null&&(a=function(a){return a}),e=[],b=!!this.object.prototype,c=b?(g=this.object.__super__)!=null?g.constructor:void 0:(d=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:d,c!=null&&((h=c._batman)!=null&&h.check(c),f=a(c),f!=null&&e.push(f),c._batman!=null&&(e=e.concat(c._batman.ancestors(a))));return e},a.prototype.set=function(a,b){return this[a]=b};return a}(),C=function(){function c(){var a;a=1<=arguments.length?bb.call(arguments,0):[],this._batman=new R(this),this.mixin.apply(this,a)}var a,b;be(c,Object),B.initializeObject(c),B.initializeObject(c.prototype),c.global=function(a){if(a!==!1)return B.container[h(this)]=this},c.classMixin=function(){return m.apply(null,[this].concat(bb.call(arguments)))},c.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},c.prototype.mixin=c.classMixin,a=0,c.prototype._objectID=function(){var b;this._objectID=function(){return b};return b=a++},c.prototype.hashKey=function(){var a;if(typeof this.isEqual!="function"){this.hashKey=function(){return a};return a="<Batman.Object "+this._objectID()+">"}},c.prototype.toJSON=function(){var a,b,c;b={};for(a in this){if(!bc.call(this,a))continue;c=this[a],a!=="_batman"&&a!=="hashKey"&&a!=="_objectID"&&(b[a]=c.toJSON?c.toJSON():c)}return b},b=function(a){!a.get&&!a.set&&!a.unset&&(a={get:a});return a},c.classAccessor=function(){var a,c,d,e,f,g,h,i;d=2<=arguments.length?bb.call(arguments,0,f=arguments.length-1):(f=0,[]),a=arguments[f++],B.initializeObject(this);if(d.length===0)return this._batman.defaultAccessor=b(a);(e=this._batman).keyAccessors||(e.keyAccessors=new B.SimpleHash),i=[];for(g=0,h=d.length;g<h;g++)c=d[g],i.push(this._batman.keyAccessors.set(c,b(a)));return i},c.accessor=function(){return this.classAccessor.apply(this.prototype,arguments)},c.prototype.accessor=c.classAccessor,c.classMixin(B.EventEmitter,B.Observable),c.mixin(B.EventEmitter,B.Observable),c.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},c.singleton=function(a){a==null&&(a="sharedInstance");return this.classAccessor(a,{get:function(){var b;return this[b="_"+a]||(this[b]=new this)}})};return c}(),B.Object=C,B.Accessible=function(){function a(){this.accessor.apply(this,arguments)}be(a,B.Object);return a}(),B.TerminalAccessible=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Accessible),a.prototype.propertyClass=B.Property;return a}(),B.Enumerable={isEnumerable:!0,map:function(a,b){var c;b==null&&(b=B.container),c=[],this.forEach(function(){return c.push(a.apply(b,arguments))});return c},mapToProperty:function(a){var b;b=[],this.forEach(function(c){return b.push(c.get(a))});return b},every:function(a,b){var c;b==null&&(b=B.container),c=!0,this.forEach(function(){return c=c&&a.apply(b,arguments)});return c},some:function(a,b){var c;b==null&&(b=B.container),c=!1,this.forEach(function(){return c=c||a.apply(b,arguments)});return c},reduce:function(a,b){var c,d;c=0,d=this,this.forEach(function(){return b!=null?b=a.apply(null,[b].concat(bb.call(arguments),[c],[d])):b=arguments[0]});return b},filter:function(a){var b,c;b=new this.constructor,b.add?c=function(b,c){a(c)&&b.add(c);return b}:b.set?c=function(b,c,d){a(c,d)&&b.set(c,d);return b}:(b.push||(b=[]),c=function(b,c){a(c)&&b.push(c);return b});return this.reduce(c,b)}},e=function(a){var b,c,d,e;d=B.Enumerable,e=[];for(b in d)c=d[b],e.push(a[b]=c);return e},B.SimpleHash=function(){function a(a){this._storage={},this.length=0,a!=null&&this.update(a)}e(a.prototype),a.prototype.propertyClass=B.Property,a.prototype.hasKey=function(a){var b,c,d,e;if(c=this._storage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return!0}return!1},a.prototype.get=function(a){var b,c,d,e;if(c=this._storage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return b[1]}},a.prototype.set=function(a,b){var c,d,e,f,g,h;d=(e=this._storage)[h=this.hashKeyFor(a)]||(e[h]=[]);for(f=0,g=d.length;f<g;f++){c=d[f];if(this.equality(c[0],a))return c[1]=b}this.length++,d.push([a,b]);return b},a.prototype.unset=function(a){var b,c,d,e,f,g,h,i;b=this.hashKeyFor(a);if(f=this._storage[b])for(c=0,h=f.length;c<h;c++){i=f[c],d=i[0],g=i[1];if(this.equality(d,a)){e=f.splice(c,1),f.length||delete this._storage[b],this.length--;return e[0][1]}}},a.prototype.getOrSet=B.Observable.getOrSet,a.prototype.hashKeyFor=function(a){return(a!=null?typeof a.hashKey=="function"?a.hashKey():void 0:void 0)||a},a.prototype.equality=function(a,b){if(a===b)return!0;if(a!==a&&b!==b)return!0;if((a!=null?typeof a.isEqual=="function"?a.isEqual(b):void 0:void 0)&&(b!=null?typeof b.isEqual=="function"?b.isEqual(a):void 0:void 0))return!0;return!1},a.prototype.forEach=function(a,b){var c,d,e,f,g,h;g=this._storage,h=[];for(c in g)f=g[c],h.push(function(){var c,g,h,i,j;h=f.slice(),j=[];for(c=0,g=h.length;c<g;c++)i=h[c],d=i[0],e=i[1],j.push(a.call(b,d,e,this));return j}.call(this));return h},a.prototype.keys=function(){var a;a=[],B.SimpleHash.prototype.forEach.call(this,function(b){return a.push(b)});return a},a.prototype.clear=function(){this._storage={};return this.length=0},a.prototype.isEmpty=function(){return this.length===0},a.prototype.merge=function(){var a,b,c,d,e;c=1<=arguments.length?bb.call(arguments,0):[],b=new this.constructor,c.unshift(this);for(d=0,e=c.length;d<e;d++)a=c[d],a.forEach(function(a,c){return b.set(a,c)});return b},a.prototype.update=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(this.set(b,c));return d},a.prototype.replace=function(a){this.forEach(bf(function(b,c){if(!(b in a))return this.unset(b)},this));return this.update(a)},a.prototype.toObject=function(){var a,b,c,d;b={},d=this._storage;for(a in d)c=d[a],b[a]=c[0][1];return b},a.prototype.toJSON=a.prototype.toObject;return a}(),B.Hash=function(){function h(){this.meta=new this.constructor.Metadata(this),B.SimpleHash.apply(this,arguments),h.__super__.constructor.apply(this,arguments)}var a,b,c,d,f,g;be(h,B.Object),h.Metadata=function(){function a(a){this.hash=a}be(a,B.Object),a.accessor("length",function(){this.hash.registerAsMutableSource();return this.hash.length}),a.accessor("isEmpty",function(){return this.hash.isEmpty()}),a.accessor("keys",function(){return this.hash.keys()});return a}(),e(h.prototype),h.prototype.propertyClass=B.Property,h.accessor({get:B.SimpleHash.prototype.get,set:h.mutation(function(a,b){var c;c=B.SimpleHash.prototype.set.call(this,a,b),this.fire("itemsWereAdded",a);return c}),unset:h.mutation(function(a){var b;b=B.SimpleHash.prototype.unset.call(this,a),b!=null&&this.fire("itemsWereRemoved",a);return b}),cachable:!1}),h.prototype._preventMutationEvents=function(a){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereRemoved");try{return a.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereRemoved")}},h.prototype.clear=h.mutation(function(){var a,b;a=this.keys(),this._preventMutationEvents(function(){return this.forEach(bf(function(a){return this.unset(a)},this))}),b=B.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(bb.call(a)));return b}),h.prototype.update=h.mutation(function(a){var b;b=[],this._preventMutationEvents(function(){return B.forEach(a,bf(function(a,c){this.hasKey(a)||b.push(a);return this.set(a,c)},this))});if(b.length>0)return this.fire.apply(this,["itemsWereAdded"].concat(bb.call(b)))}),h.prototype.replace=h.mutation(function(a){var b,c;b=[],c=[],this._preventMutationEvents(function(){this.forEach(bf(function(b,d){if(!B.objectHasKey(a,b)){this.unset(b);return c.push(b)}},this));return B.forEach(a,bf(function(a,c){this.hasKey(a)||b.push(a);return this.set(a,c)},this))}),b.length>0&&this.fire.apply(this,["itemsWereAdded"].concat(bb.call(b)));if(c.length>0)return this.fire.apply(this,["itemsWereRemoved"].concat(bb.call(c)))}),h.prototype.equality=B.SimpleHash.prototype.equality,h.prototype.hashKeyFor=B.SimpleHash.prototype.hashKeyFor,g=["hasKey","forEach","isEmpty","keys","merge","toJSON","toObject"],c=function(a){return b[a]=function(){this.registerAsMutableSource();return B.SimpleHash.prototype[a].apply(this,arguments)}};for(d=0,f=g.length;d<f;d++)a=g[d],b=h.prototype,c(a);return h}.call(this),B.SimpleSet=function(){function a(){this._storage=new B.SimpleHash,this._indexes=new B.SimpleHash,this._uniqueIndexes=new B.SimpleHash,this._sorts=new B.SimpleHash,this.length=0,arguments.length>0&&this.add.apply(this,arguments)}e(a.prototype),a.prototype.has=function(a){return this._storage.hasKey(a)},a.prototype.add=function(){var a,b,c,d,e;c=1<=arguments.length?bb.call(arguments,0):[],a=[];for(d=0,e=c.length;d<e;d++)b=c[d],this._storage.hasKey(b)||(this._storage.set(b,!0),a.push(b),this.length++);this.fire&&a.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(bb.call(a))));return a},a.prototype.remove=function(){var a,b,c,d,e;b=1<=arguments.length?bb.call(arguments,0):[],c=[];for(d=0,e=b.length;d<e;d++)a=b[d],this._storage.hasKey(a)&&(this._storage.unset(a),c.push(a),this.length--);this.fire&&c.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(bb.call(c))));return c},a.prototype.forEach=function(a,b){var c;c=this;return this._storage.forEach(function(d){return a.call(b,d,null,c)})},a.prototype.isEmpty=function(){return this.length===0},a.prototype.clear=function(){var a;a=this.toArray(),this._storage=new B.SimpleHash,this.length=0,this.fire&&a.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(bb.call(a))));return a},a.prototype.replace=function(a){try{typeof this.prevent=="function"&&this.prevent("change"),this.clear();return this.add.apply(this,a.toArray())}finally{typeof this.allowAndFire=="function"&&this.allowAndFire("change",this,this)}},a.prototype.toArray=function(){return this._storage.keys()},a.prototype.merge=function(){var a,b,c,d,e;b=1<=arguments.length?bb.call(arguments,0):[],a=new this.constructor,b.unshift(this);for(d=0,e=b.length;d<e;d++)c=b[d],c.forEach(function(b){return a.add(b)});return a},a.prototype.indexedBy=function(a){return this._indexes.get(a)||this._indexes.set(a,new B.SetIndex(this,a))},a.prototype.indexedByUnique=function(a){return this._uniqueIndexes.get(a)||this._uniqueIndexes.set(a,new B.UniqueSetIndex(this,a))},a.prototype.sortedBy=function(a,b){var c;b==null&&(b="asc"),b=b.toLowerCase()==="desc"?"desc":"asc",c=this._sorts.get(a)||this._sorts.set(a,new B.Object);return c.get(b)||c.set(b,new B.SetSort(this,a,b))};return a}(),B.Set=function(){function k(){B.SimpleSet.apply(this,arguments)}var a,b,c,d,f,g,h,i,j;be(k,B.Object),e(k.prototype),i=["add","remove","clear","replace","indexedBy","indexedByUnique","sortedBy"];for(d=0,g=i.length;d<g;d++)a=i[d],k.prototype[a]=B.SimpleSet.prototype[a];j=["merge","forEach","toArray","isEmpty","has"],c=function(a){return b[a]=function(){this.registerAsMutableSource();return B.SimpleSet.prototype[a].apply(this,arguments)}};for(f=0,h=j.length;f<h;f++)a=j[f],b=k.prototype,c(a);k.prototype.toJSON=k.prototype.toArray;return k}(),E=function(a){a.accessor("first",function(){return this.toArray()[0]}),a.accessor("last",function(){return this.toArray()[this.length-1]}),a.accessor("indexedBy",function(){return new B.TerminalAccessible(bf(function(a){return this.indexedBy(a)},this))}),a.accessor("indexedByUnique",function(){return new B.TerminalAccessible(bf(function(a){return this.indexedByUnique(a)},this))}),a.accessor("sortedBy",function(){return new B.TerminalAccessible(bf(function(a){return this.sortedBy(a)},this))}),a.accessor("sortedByDescending",function(){return new B.TerminalAccessible(bf(function(a){return this.sortedBy(a,"desc")},this))}),a.accessor("isEmpty",function(){return this.isEmpty()}),a.accessor("toArray",function(){return this.toArray()});return a.accessor("length",function(){this.registerAsMutableSource();return this.length})},E(B.Set),B.SetObserver=function(){function a(a){this.base=a,this._itemObservers=new B.SimpleHash,this._setObservers=new B.SimpleHash,this._setObservers.set("itemsWereAdded",bf(function(){return this.fire.apply(this,["itemsWereAdded"].concat(bb.call(arguments)))},this)),this._setObservers.set("itemsWereRemoved",bf(function(){return this.fire.apply(this,["itemsWereRemoved"].concat(bb.call(arguments)))},this)),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}be(a,B.Object),a.prototype.observedItemKeys=[],a.prototype.observerForItemAndKey=function(a,b){},a.prototype._getOrSetObserverForItemAndKey=function(a,b){return this._itemObservers.getOrSet(a,bf(function(){var c;c=new B.SimpleHash;return c.getOrSet(b,bf(function(){return this.observerForItemAndKey(a,b)},this))},this))},a.prototype.startObserving=function(){this._manageItemObservers("observe");return this._manageSetObservers("addHandler")},a.prototype.stopObserving=function(){this._manageItemObservers("forget");return this._manageSetObservers("removeHandler")},a.prototype.startObservingItems=function(){var a,b,c,d,e;b=1<=arguments.length?bb.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._manageObserversForItem(a,"observe"));return e},a.prototype.stopObservingItems=function(){var a,b,c,d,e;b=1<=arguments.length?bb.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._manageObserversForItem(a,"forget"));return e},a.prototype._manageObserversForItem=function(a,b){var c,d,e,f;if(!!a.isObservable){f=this.observedItemKeys;for(d=0,e=f.length;d<e;d++)c=f[d],a[b](c,this._getOrSetObserverForItemAndKey(a,c));if(b==="forget")return this._itemObservers.unset(a)}},a.prototype._manageItemObservers=function(a){return this.base.forEach(bf(function(b){return this._manageObserversForItem(b,a)},this))},a.prototype._manageSetObservers=function(a){if(!!this.base.isObservable)return this._setObservers.forEach(bf(function(b,c){return this.base.event(b)[a](c)},this))};return a}(),B.SetProxy=function(){function k(){k.__super__.constructor.call(this),this.length=0,this.base.on("itemsWereAdded",bf(function(){var a;a=1<=arguments.length?bb.call(arguments,0):[];return this.fire.apply(this,["itemsWereAdded"].concat(bb.call(a)))},this)),this.base.on("itemsWereRemoved",bf(function(){var a;a=1<=arguments.length?bb.call(arguments,0):[];return this.fire.apply(this,["itemsWereRemoved"].concat(bb.call(a)))},this))}var a,b,c,d,f,g,h,i,j;be(k,B.Object),e(k.prototype),k.prototype.filter=function(a){var b;b=new B.Set;return this.reduce(function(b,c){a(c)&&b.add(c);return b},b)},i=["add","remove","clear","replace"],b=bf(function(a){return this.prototype[a]=function(){var b,c;b=(c=this.base)[a].apply(c,arguments),this.length=this.set("length",this.base.get("length"));return b}},k);for(d=0,g=i.length;d<g;d++)a=i[d],b(a);j=["has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],c=bf(function(a){return this.prototype[a]=function(){var b;return(b=this.base)[a].apply(b,arguments)}},k);for(f=0,h=j.length;f<h;f++)a=j[f],c(a);E(k),k.accessor("length",{get:function(){this.registerAsMutableSource();return this.length},set:function(a,b){return this.length=b}});return k}.call(this),B.SetSort=function(){function a(b,c,d){var e;this.base=b,this.key=c,d==null&&(d="asc"),a.__super__.constructor.call(this),this.descending=d.toLowerCase()==="desc",this.base.isObservable&&(this._setObserver=new B.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],e=this._reIndex.bind(this),this._setObserver.observerForItemAndKey=function(){return e},this._setObserver.on("itemsWereAdded",e),this._setObserver.on("itemsWereRemoved",e),this.startObserving()),this._reIndex()}be(a,B.SetProxy),a.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},a.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},a.prototype.toArray=function(){return this.get("_storage")},a.prototype.forEach=function(a,b){var c,d,e,f,g;f=this.get("_storage"),g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(a.call(b,c,d,this));return g},a.prototype.compare=function(a,b){if(a===b)return 0;if(a===void 0)return 1;if(b===void 0)return-1;if(a===null)return 1;if(b===null)return-1;if(a===!1)return 1;if(b===!1)return-1;if(a===!0)return 1;if(b===!0)return-1;if(a!==a)return b!==b?0:1;if(b!==b)return-1;if(a>b)return 1;if(a<b)return-1;return 0},a.prototype._reIndex=function(){var a,b;a=this.base.toArray().sort(bf(function(a,b){var c,d,e;d=i(a,this.key),d!=null&&(d=d.valueOf()),e=i(b,this.key),e!=null&&(e=e.valueOf()),c=this.descending?-1:1;return this.compare.call(this,d,e)*c},this)),(b=this._setObserver)!=null&&b.startObservingItems.apply(b,a);return this.set("_storage",a)};return a}(),B.SetIndex=function(){function a(b,c){this.base=b,this.key=c,a.__super__.constructor.call(this),this._storage=new B.SimpleHash,this.base.isEventEmitter&&(this._setObserver=new B.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",bf(function(){var a,b,c,d,e;b=1<=arguments.length?bb.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._addItem(a));return e},this)),this._setObserver.on("itemsWereRemoved",bf(function(){var a,b,c,d,e;b=1<=arguments.length?bb.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._removeItem(a));return e},this))),this.base.forEach(this._addItem.bind(this)),this.startObserving()}be(a,B.Object),a.accessor(function(a){return this._resultSetForKey(a)}),a.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},a.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},a.prototype.observerForItemAndKey=function(a,b){return bf(function(b,c){this._removeItemFromKey(a,c);return this._addItemToKey(a,b)},this)},a.prototype._addItem=function(a){return this._addItemToKey(a,this._keyForItem(a))},a.prototype._addItemToKey=function(a,b){return this._resultSetForKey(b).add(a)},a.prototype._removeItem=function(a){return this._removeItemFromKey(a,this._keyForItem(a))},a.prototype._removeItemFromKey=function(a,b){return this._resultSetForKey(b).remove(a)},a.prototype._resultSetForKey=function(a){return this._storage.getOrSet(a,function(){return new B.Set})},a.prototype._keyForItem=function(a){return B.Keypath.forBaseAndKey(a,this.key).getValue()};return a}(),B.UniqueSetIndex=function(){function a(){this._uniqueIndex=new B.Hash,a.__super__.constructor.apply(this,arguments)}be(a,B.SetIndex),a.accessor(function(a){return this._uniqueIndex.get(a)}),a.prototype._addItemToKey=function(a,b){this._resultSetForKey(b).add(a);if(!this._uniqueIndex.hasKey(b))return this._uniqueIndex.set(b,a)},a.prototype._removeItemFromKey=function(b,c){var d;d=this._resultSetForKey(c),a.__super__._removeItemFromKey.apply(this,arguments);return d.isEmpty()?this._uniqueIndex.unset(c):this._uniqueIndex.set(c,d.toArray()[0])};return a}(),B.BinarySetOperation=function(){function a(b,c){this.left=b,this.right=c,this._setup=bf(this._setup,this),a.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}be(a,B.Set),a.prototype._setup=function(a,b){a.on("itemsWereAdded",bf(function(){var c;c=1<=arguments.length?bb.call(arguments,0):[];return this._itemsWereAddedToSource.apply(this,[a,b].concat(bb.call(c)))},this)),a.on("itemsWereRemoved",bf(function(){var c;c=1<=arguments.length?bb.call(arguments,0):[];return this._itemsWereRemovedFromSource.apply(this,[a,b].concat(bb.call(c)))},this));return this._itemsWereAddedToSource.apply(this,[a,b].concat(bb.call(a.toArray())))},a.prototype.merge=function(){var a,b,c,d,e;b=1<=arguments.length?bb.call(arguments,0):[],a=new B.Set,b.unshift(this);for(d=0,e=b.length;d<e;d++)c=b[d],c.forEach(function(b){return a.add(b)});return a},a.prototype.filter=B.SetProxy.prototype.filter;return a}(),B.SetUnion=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.BinarySetOperation),a.prototype._itemsWereAddedToSource=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?bb.call(arguments,2):[];return this.add.apply(this,a)},a.prototype._itemsWereRemovedFromSource=function(){var a,b,c,d,e;e=arguments[0],d=arguments[1],b=3<=arguments.length?bb.call(arguments,2):[],c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)a=b[c],d.has(a)||f.push(a);return f}();return this.remove.apply(this,c)};return a}(),B.SetIntersection=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.BinarySetOperation),a.prototype._itemsWereAddedToSource=function(){var a,b,c,d,e;e=arguments[0],d=arguments[1],b=3<=arguments.length?bb.call(arguments,2):[],c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)a=b[c],d.has(a)&&f.push(a);return f}();return this.add.apply(this,c)},a.prototype._itemsWereRemovedFromSource=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?bb.call(arguments,2):[];return this.remove.apply(this,a)};return a}(),B.StateMachine={initialize:function(){B.initializeObject(this);if(!this._batman.states)return this._batman.states=new B.SimpleHash},state:function(a,b){B.StateMachine.initialize.call(this);if(!a)return this._batman.getFirst("state");this[a]||(this[a]=function(b){return ba.call(this,a)});if(typeof b=="function")return this.on(a,b)},transition:function(a,b,c){B.StateMachine.initialize.call(this),this.state(a),this.state(b);if(c)return this.on(""+a+"->"+b,c)}},B.Object.actsAsStateMachine=function(a){a==null&&(a=!0),B.StateMachine.initialize.call(this),B.StateMachine.initialize.call(this.prototype),this.classState=function(){return B.StateMachine.state.apply(this,arguments)},this.state=function(){return this.classState.apply(this.prototype,arguments)},a&&(this.prototype.state=this.classState),this.classTransition=function(){return B.StateMachine.transition.apply(this,arguments)},this.transition=function(){return this.classTransition.apply(this.prototype,arguments)};if(a)return this.prototype.transition=this.classTransition},ba=function(a){var b,c,d;B.StateMachine.initialize.call(this);if(this._batman.isTransitioning){((c=this._batman).nextState||(c.nextState=[])).push(a);return!1}this._batman.isTransitioning=!0,b=this.state(),this._batman.state=a,a&&b&&this.fire(""+b+"->"+a,a,b),a&&this.fire(a,a,b),this._batman.isTransitioning=!1,((d=this._batman.nextState)!=null?d.length:void 0)&&this[this._batman.nextState.shift()]();return a},B.Request=function(){function a(b){var c,d,e;d={};for(e in b){c=b[e];if(e==="success"||e==="error"||e==="loading"||e==="loaded")d[e]=c,delete b[e]}a.__super__.constructor.call(this,b);for(e in d)c=d[e],this.on(e,c)}be(a,B.Object),a.objectToFormData=function(a){var b,c,d,e,f,g,h,i;d=function(a,b,c){var e,f,g;c==null&&(c=!1);return f=function(){switch(B.typeOf(b)){case"Object":f=function(){var f;f=[];for(e in b)g=b[e],f.push(d(c?e:""+a+"["+e+"]",g));return f}();return f.reduce(function(a,b){return a.concat(b)},[]);case"Array":return b.reduce(function(b,c){return b.concat(d(""+a+"[]",c))},[]);default:return[[a,b]]}}()},b=new FormData,h=d("",a,!0);for(f=0,g=h.length;f<g;f++)i=h[f],c=i[0],e=i[1],b.append(c,e);return b},a.prototype.url="",a.prototype.data="",a.prototype.method="GET",a.prototype.formData=!1,a.prototype.response=null,a.prototype.status=null,a.prototype.headers={},a.accessor("method",m({},B.Property.defaultAccessor,{set:function(a,b){return this[a]=b!=null?typeof b.toUpperCase=="function"?b.toUpperCase():void 0:void 0}})),a.prototype.contentType="application/x-www-form-urlencoded",a.observeAll("url",function(){return this._autosendTimeout=t(bf(function(){return this.send()},this))}),a.prototype.send=function(){},a.prototype.cancel=function(){if(this._autosendTimeout)return c(this._autosendTimeout)};return a}(),B.App=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Object),a.classAccessor("currentParams",{get:function(){return new B.Hash},"final":!0}),a.classAccessor("paramsManager",{get:function(){var a,b;if(!!(a=this.get("navigator"))){b=this.get("currentParams");return b.replacer=new B.ParamsReplacer(a,b)}},"final":!0}),a.classAccessor("paramsPusher",{get:function(){var a,b;if(!!(a=this.get("navigator"))){b=this.get("currentParams");return b.pusher=new B.ParamsPusher(a,b)}},"final":!0}),a.requirePath="",a.layout=void 0,a.event("ready").oneShot=!0,a.event("run").oneShot=!0,a.run=function(){if(B.currentApp){if(B.currentApp===this)return;B.currentApp.stop()}if(this.hasRun)return!1;if(this.isPrevented("run")){this.wantsToRun=!0;return!1}delete this.wantsToRun,B.currentApp=this,B.App.set("current",this),this.get("dispatcher")==null&&this.set("dispatcher",new B.Dispatcher(this)),this.get("navigator")==null&&(this.set("navigator",B.Navigator.forApp(this)),this.on("run",bf(function(){B.navigator=this.get("navigator");if(Object.keys(this.get("dispatcher").routeMap).length>0)return B.navigator.start()},this))),this.observe("layout",bf(function(a){return a!=null?a.on("ready",bf(function(){return this.fire("ready")},this)):void 0},this)),typeof this.layout=="undefined"?this.set("layout",new B.View({context:this,node:document})):typeof this.layout=="string"&&this.set("layout",new(this[K.camelize(this.layout)+"View"])),this.hasRun=!0,this.fire("run");return this},a.event("ready").oneShot=!0,a.event("stop").oneShot=!0,a.stop=function(){var a;(a=this.navigator)!=null&&a.stop(),B.navigator=null,this.hasRun=!1,this.fire("stop");return this};return a}.call(this),B.Route=function(){function f(){var g;this.options={},f.__super__.constructor.apply(this,arguments),this.pattern=this.url.replace(a,"\\$&"),this.regexp=new RegExp("^"+this.pattern.replace(c,"([^/]*)").replace(e,"(.*?)")+d+"$"),this.namedArguments=[];while((g=b.exec(this.pattern))!=null)g[1]&&this.namedArguments.push(g[1])}var a,b,c,d,e;be(f,B.Object),c=/:([\w\d]+)/g,e=/\*([\w\d]+)/g,d="(?:\\?.+)?",b=/[:|\*]([\w\d]+)/g,a=/[-[\]{}()+?.,\\^$|#\s]/g,f.accessor("action",{get:function(){var a,b,c;if(this.action)return this.action;if(this.options){b=m({},this.options);if(c=b.signature)a=c.split("#"),b.controller=a[0],b.action=a[1]||"index";b.target=this.dispatcher.app.controllers.get(b.controller);return this.set("action",b)}},set:function(a,b){return this.action=b}}),f.prototype.parameterize=function(a){var b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r;o=a.split("?"),a=o[0],h=o[1],c=(p=this.regexp.exec(a))!=null?p.slice(1):void 0,g={url:a},b=this.get("action"),typeof b=="function"?g.action=b:m(g,b);if(c)for(d=0,l=c.length;d<l;d++)f=c[d],g[this.namedArguments[d]]=f;if(h){q=h.split("&");for(k=0,n=q.length;k<n;k++)i=q[k],r=i.split("="),e=r[0],j=r[1],g[e]=j}return g},f.prototype.dispatch=function(a){var b,c,d,e;c=this.parameterize(a),this.dispatcher.app.get("currentParams").replace(c),!(b=c.action)&&a!=="/404"&&q("/404");if(typeof b=="function")return b(c);if((d=c.target)!=null?d.dispatch:void 0)return c.target.dispatch(b,c);return(e=c.target)!=null?e[b](c):void 0};return f}(),B.Dispatcher=function(){function a(a){var b,c,d;this.app=a,this.routeMap={},this.app.route(this),this.app.controllers=new B.Object,d=this.app;for(c in d){b=d[c];if(!((b!=null?b.prototype:void 0)instanceof B.Controller))continue;this.prepareController(b)}}be(a,B.Object),a.paramsFromArgument=function(a){var b;b=function(a){return K.underscore(K.pluralize(h(a)))};if(a instanceof B.Model||a instanceof B.AssociationProxy){a.isProxy&&(a=a.get("target"));return a!=null?{resource:b(a.constructor),action:"show",id:a.get("id")}:{}}return a.prototype instanceof B.Model?{resource:b(a),action:"index"}:a},a.prototype.prepareController=function(a){var b,c;c=K.underscore(h(a).replace("Controller",""));if(!!c){b=function(){return a.get("sharedController")};return this.app.controllers.accessor(c,b)}},a.prototype.register=function(a,b){var c;a.indexOf("/")!==0&&(a="/"+a),c=x(b)==="Function"?new B.Route({url:a,action:b,dispatcher:this}):new B.Route({url:a,options:b,dispatcher:this});return this.routeMap[a]=c},a.prototype.findRoute=function(a){var b,c,d;a.indexOf("/")!==0&&(a="/"+a);if(b=this.routeMap[a])return b;d=this.routeMap;for(c in d){b=d[c];if(b.regexp.test(a))return b}},a.prototype.findUrl=function(a){var b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r,s;q=this.routeMap;for(l in q){k=q[l],f=!1,g=k.options,a.resource?f=g.resource===a.resource&&g.action===a.action:(b=k.get("action"),typeof b=="function"?f=!0:(r=b,c=r.controller,b=r.action,c===a.controller&&b===(a.action||"index")&&(f=!0)));if(!f)continue;h=m({},a),s=["controller","action","resource","url","signature","target"];for(o=0,p=s.length;o<p;o++)d=s[o],delete h[d];for(e in a){n=a[e],j=new RegExp("[:|*]"+e);if(!j.test(l))continue;l=l.replace(j,n),h[e]=null,delete h[e]}i="";for(e in h)n=h[e],i+=i?"&":"?",i+=e+"="+n;return l+i}},a.prototype.pathFromParams=function(a){var b;b=this.constructor.paramsFromArgument(a);return x(b)==="String"?B.Navigator.normalizePath(b):this.findUrl(b)},a.prototype.dispatch=function(a){var b,c,d;d=this.pathFromParams(a),d!=null&&(c=this.findRoute(d));if(c)c.dispatch(d);else{if(x(a)==="Object"){b=this.constructor.paramsFromArgument(a);if(b===a)return this.app.get("currentParams").replace(a)}else this.app.get("currentParams").clear();if(d!=="/404")return q("/404")}this.app.set("currentURL",d),this.app.set("currentRoute",c);return d};return a}(),B.Navigator=function(){function a(a){this.app=a,this.handleCurrentLocation=bf(this.handleCurrentLocation,this)}a.defaultClass=function(){return B.config.usePushState&&B.PushStateNavigator.isSupported()?B.PushStateNavigator:B.HashbangNavigator},a.forApp=function(a){return new(this.defaultClass())(a)},a.prototype.start=function(){if(typeof window!="undefined"){if(this.started)return;this.started=!0,this.startWatching(),B.currentApp.prevent("ready");return t(bf(function(){this.handleCurrentLocation();return B.currentApp.allowAndFire("ready")},this))}},a.prototype.stop=function(){this.stopWatching();return this.started=!1},a.prototype.handleLocation=function(a){var b;b=this.pathFromLocation(a);if(b!==this.cachedPath)return this.dispatch(b)},a.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},a.prototype.dispatch=function(a){return this.cachedPath=this.app.dispatcher.dispatch(a)},a.prototype.push=function(a){var b;b=this.dispatch(a),this.pushState(null,"",b);return b},a.prototype.replace=function(a){var b;b=this.dispatch(a),this.replaceState(null,"",b);return b},a.prototype.redirect=a.prototype.push,a.prototype.normalizePath=function(){var a,b,c;c=1<=arguments.length?bb.call(arguments,0):[],c=function(){var d,e;e=[];for(a=0,d=c.length;a<d;a++)b=c[a],e.push((""+b).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return e}();return c.join("")||"/"},a.normalizePath=a.prototype.normalizePath;return a}(),B.PushStateNavigator=function(){function b(){b.__super__.constructor.apply(this,arguments)}be(b,B.Navigator),b.isSupported=function(){var a;return(typeof window!="undefined"&&window!==null?(a=window.history)!=null?a.pushState:void 0:void 0)!=null},b.prototype.startWatching=function(){return a(window,"popstate",this.handleCurrentLocation)},b.prototype.stopWatching=function(){return r(window,"popstate",this.handleCurrentLocation)},b.prototype.pushState=function(a,b,c){return window.history.pushState(a,b,this.linkTo(c))},b.prototype.replaceState=function(a,b,c){return window.history.replaceState(a,b,this.linkTo(c))},b.prototype.linkTo=function(a){return this.normalizePath(B.config.pathPrefix,a)},b.prototype.pathFromLocation=function(a){var b,c;b=""+(a.pathname||"")+(a.search||""),c=new RegExp("^"+this.normalizePath(B.config.pathPrefix));return this.normalizePath(b.replace(c,""))},b.prototype.handleLocation=function(a){var c,d;d=this.pathFromLocation(a);return d==="/"&&(c=B.HashbangNavigator.prototype.pathFromLocation(a))!=="/"?this.replace(c):b.__super__.handleLocation.apply(this,arguments)};return b}(),B.HashbangNavigator=function(){function b(){b.__super__.constructor.apply(this,arguments)}be(b,B.Navigator),b.prototype.HASH_PREFIX="#!",typeof window!="undefined"&&window!==null&&"onhashchange"in window?(b.prototype.startWatching=function(){return a(window,"hashchange",this.handleCurrentLocation)},b.prototype.stopWatching=function(){return r(window,"hashchange",this.handleCurrentLocation)}):(b.prototype.startWatching=function(){return this.interval=setInterval(this.handleCurrentLocation,100)},b.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),b.prototype.pushState=function(a,b,c){return window.location.hash=this.linkTo(c)},b.prototype.replaceState=function(a,b,c){var d;d=window.location;return d.replace(""+d.pathname+d.search+this.linkTo(c))},b.prototype.linkTo=function(a){return this.HASH_PREFIX+a},b.prototype.pathFromLocation=function(a){var b;b=a.hash;return(b!=null?b.substr(0,2):void 0)===this.HASH_PREFIX?this.normalizePath(b.substr(2)):"/"},b.prototype.handleLocation=function(a){var c;if(!B.config.usePushState)return b.__super__.handleLocation.apply(this,arguments);c=B.PushStateNavigator.prototype.pathFromLocation(a);return c==="/"?b.__super__.handleLocation.apply(this,arguments):a.replace(this.normalizePath(""+B.config.pathPrefix+this.linkTo(c)))};return b}(),B.redirect=q=function(a){var b;return(b=B.navigator)!=null?b.redirect(a):void 0},B.ParamsReplacer=function(){function a(a,b){this.navigator=a,this.params=b}be(a,B.Object),a.prototype.redirect=function(){return this.navigator.replace(this.toObject())},a.prototype.replace=function(a){this.params.replace(a);return this.redirect()},a.prototype.update=function(a){this.params.update(a);return this.redirect()},a.prototype.clear=function(){this.params.clear();return this.redirect()},a.prototype.toObject=function(){return this.params.toObject()},a.accessor({get:function(a){return this.params.get(a)},set:function(a,b){var c,d;c=this.params.get(a),d=this.params.set(a,b),c!==b&&this.redirect();return d},unset:function(a){var b,c;b=this.params.hasKey(a),c=this.params.unset(a),b&&this.redirect();return c}});return a}(),B.ParamsPusher=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.ParamsReplacer),a.prototype.redirect=function(){return this.navigator.push(this.toObject())};return a}(),B.App.classMixin({route:function(a,b,c){var d,e,f,g;c==null&&(c={});if(!!a){if(a instanceof B.Dispatcher){d=a,g=this._dispatcherCache;for(e in g)f=g[e],d.register(e,f);this._dispatcherCache=null;return d}typeof b=="string"?c.signature=b:x(b)==="Function"?c=b:b&&m(c,b),this._dispatcherCache||(this._dispatcherCache={});return this._dispatcherCache[a]=c}},root:function(a,b){return this.route("/",a,b)},resource:function(a,b,c){var d,e,f,g;b==null&&(b={}),typeof b=="function"&&(c=b,b={}),a=K.pluralize(a),e=b.controller||a,g=bf(function(a,b,c){return this.route(a,b,{resource:e,action:c})},this),b.parentResource&&(a=""+b.parentResource+"/:"+K.singularize(b.parentResource)+"Id/"+a),b.index!==!1&&g(a,""+e+"#index","index"),b["new"]!==!1&&g(""+a+"/new",""+e+"#new","new"),b.show!==!1&&g(""+a+"/:id",""+e+"#show","show"),b.edit!==!1&&g(""+a+"/:id/edit",""+e+"#edit","edit"),c&&(d=this,f={resource:a,collection:function(b){return b!=null?b.call({route:function(b,c){c==null&&(c=b);return d.route(""+a+"/"+b,""+e+"#"+c,{action:c,resource:a,controller:e})}}):void 0},member:function(b){return b!=null?b.call({route:function(b,c){c==null&&(c=b);return d.route(""+a+"/:id/"+b,""+e+"#"+c,{action:c,resource:a,controller:e})}}):void 0},resources:bf(function(b,c,d){c==null&&(c={}),typeof c=="function"&&(d=c,c={}),c.parentResource=a;return this.resources(b,c,d)},this)},c.call(f));return this},resources:function(a,b,c){var d,e,f,g,h,i;if(x(b)==="String"){a=Array.prototype.slice.call(arguments),b=null,c=null,d=[];for(f=0,h=a.length;f<h;f++)e=a[f],x(e)==="String"?d.push(e):x(b)==="String"?b=e:c=e;for(g=0,i=d.length;g<i;g++)e=d[g],this.resource(e,b,c)}else this.resource(a,b,c);return this},redirect:q}),B.Controller=function(){function a(){this.redirect=bf(this.redirect,this),a.__super__.constructor.apply(this,arguments)}be(a,B.Object),a.singleton("sharedController"),a.accessor("controllerName",function(){return this._controllerName||(this._controllerName=K.underscore(h(this.constructor).replace("Controller","")))}),a.beforeFilter=function(a,b){var c,d;b?(a.only&&x(a.only)!=="Array"&&(a.only=[a.only]),a.except&&x(a.except)!=="Array"&&(a.except=[a.except])):(b=a,a={}),B.initializeObject(this),a.block=b,c=(d=this._batman).beforeFilters||(d.beforeFilters=new B.Hash);return c.set(b,a)},a.afterFilter=function(a,b){var c,d;b?(a.only&&x(a.only)!=="Array"&&(a.only=[a.only]),a.except&&x(a.except)!=="Array"&&(a.except=[a.except])):(b=a,a={}),B.initializeObject(this),a.block=b,c=(d=this._batman).afterFilters||(d.afterFilters=new B.Hash);return c.set(b,a)},a.prototype.runFilters=function(a,b){var c,d;c=a.action;if(b=(d=this.constructor._batman)!=null?d.get(b):void 0)return b.forEach(bf(function(b,d){var e;if(!(d.only&&bd.call(d.only,c)<0)){if(d.except&&bd.call(d.except,c)>=0)return;e=d.block;return typeof e=="function"?e.call(this,a):typeof this[e]=="function"?this[e](a):void 0}},this))},a.prototype.dispatch=function(a,b){var c,d,e,f,g;b==null&&(b={}),b.controller||(b.controller=this.get("controllerName")),b.action||(b.action=a),b.target||(b.target=this),c=(e=B.navigator)!=null?e.redirect:void 0,(f=B.navigator)!=null&&(f.redirect=this.redirect),this._inAction=!0,this._actedDuringAction=!1,this.set("action",a),this.set("params",b),this.runFilters(b,"beforeFilters"),this[a](b),this._actedDuringAction||this.render(),this.runFilters(b,"afterFilters"),delete this._actedDuringAction,delete this._inAction,(g=B.navigator)!=null&&(g.redirect=c),d=this._afterFilterRedirect,delete this._afterFilterRedirect;if(d)return q(d)},a.prototype.redirect=function(a){!this._actedDuringAction||!this._inAction;if(this._inAction){this._actedDuringAction=!0;return this._afterFilterRedirect=a}x(a)==="Object"&&(a.controller||(a.controller=this));return q(a)},a.prototype.render=function(a){var b,c,d;a==null&&(a={}),!this._actedDuringAction||!this._inAction,this._actedDuringAction=!0;if(a!==!1){a.view||(a.context||(a.context=this),a.source||(a.source=K.underscore(this.get("controllerName")+"/"+this.get("action"))),a.view=new(((c=B.currentApp)!=null?c[K.camelize(""+this.get("controllerName")+"_"+this.get("action")+"_view")]:void 0)||B.View)(a));if(b=a.view)(d=B.currentApp)!=null&&d.prevent("ready"),b.on("ready",bf(function(){var c;B.DOM.replace(a.into||"main",b.get("node"),b.hasContainer),(c=B.currentApp)!=null&&c.allowAndFire("ready");return typeof b.ready=="function"?b.ready(this.params):void 0},this));return b}};return a}(),B.Model=function(){function i(a){a==null&&(a={}),this.destroy=bf(this.destroy,this),this.save=bf(this.save,this),this.load=bf(this.load,this),this.dirtyKeys=new B.Hash,this.errors=new B.ErrorsSet,x(a)==="Object"?i.__super__.constructor.call(this,a):(i.__super__.constructor.call(this),this.set("id",a)),this.state()||this.empty()}var a,b,c,d,e,f,g;be(i,B.Object),i.primaryKey="id",i.storageKey=null,i.persist=function(){var a,b,c,d,e;b=1<=arguments.length?bb.call(arguments,0):[],B.initializeObject(this.prototype),d=(e=this.prototype._batman).storage||(e.storage=[]),c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)a=b[c],a=a.isStorageAdapter?a:new a(this),d.push(a),f.push(a);return f}.call(this);return c.length>1?c:c[0]},i.encode=function(){var a,b,c,d,e,f,g,h,i,j,k;e=2<=arguments.length?bb.call(arguments,0,h=arguments.length-1):(h=0,[]),c=arguments[h++],B.initializeObject(this.prototype),(f=this.prototype._batman).encoders||(f.encoders=new B.SimpleHash),(g=this.prototype._batman).decoders||(g.decoders=new B.SimpleHash);switch(x(c)){case"String":e.push(c);break;case"Function":b=c;break;default:b=c.encode,a=c.decode}typeof b=="undefined"&&(b=this.defaultEncoder.encode),typeof a=="undefined"&&(a=this.defaultEncoder.decode),k=[];for(i=0,j=e.length;i<j;i++)d=e[i],b&&this.prototype._batman.encoders.set(d,b),k.push(a?this.prototype._batman.decoders.set(d,a):void 0);return k},i.defaultEncoder={encode:function(a){return a},decode:function(a){return a}},i.observeAndFire("primaryKey",function(a){return this.encode(a,{encode:!1,decode:this.defaultEncoder.decode})}),i.validate=function(){var a,b,c,d,e,f,g,h,i,j,k,l;a=2<=arguments.length?bb.call(arguments,0,i=arguments.length-1):(i=0,[]),e=arguments[i++],B.initializeObject(this.prototype),g=(h=this.prototype._batman).validators||(h.validators=[]);if(typeof e=="function")return g.push({keys:a,callback:e});d=e,l=[];for(j=0,k=D.length;j<k;j++)f=D[j],l.push(function(){var e,h;if(c=f.matches(d)){for(e=0,h=c.length;e<h;e++)b=c[e],delete d[b];return g.push({keys:a,validator:new f(c)})}}());return l},i.classAccessor("all",{get:function(){var a;this.prototype.hasStorage()&&(a=this.classState())!=="loaded"&&a!=="loading"&&this.load();return this.get("loaded")},set:function(a,b){return this.set("loaded",b)}}),i.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new B.Set)},set:function(a,b){return this._loaded=b}}),i.classAccessor("first",function(){return this.get("all").toArray()[0]}),i.classAccessor("last",function(){var a;a=this.get("all").toArray();return a[a.length-1]}),i.clear=function(){var a,b;B.initializeObject(this),a=this.get("loaded").clear(),(b=this._batman.get("associations"))!=null&&b.reset();return a},i.find=function(a,b){var c,d;d=new this,d.set("id",a),c=this._mapIdentity(d),c.load(b);return c},i.load=function(a,b){var c;if((c=typeof a)==="function"||c==="undefined")b=a,a={};this.loading();return this.prototype._doStorageOperation("readAll",a,bf(function(a,c){var d,e;if(a!=null)return typeof b=="function"?b(a,[]):void 0;d=function(){var a,b,d;d=[];for(a=0,b=c.length;a<b;a++)e=c[a],d.push(this._mapIdentity(e));return d}.call(this),this.loaded();return typeof b=="function"?b(a,d):void 0},this))},i.create=function(a,b){var c,d;b||(d=[{},a],a=d[0],b=d[1]),c=new this(a),c.save(b);return c},i.findOrCreate=function(a,b){var c,d;d=new this(a);if(d.isNew())return d.save(b);c=this._mapIdentity(d),c.updateAttributes(a);return b(void 0,c)},i._mapIdentity=function(a){var b,c,d;if(typeof (c=a.get("id"))=="undefined"||c==="")return a;b=(d=this.get("loaded.indexedBy.id").get(c))!=null?d.toArray()[0]:void 0;if(b){b.updateAttributes(a._batman.attributes||{});return b}this.get("loaded").add(a);return a},i.prototype.associationProxy=function(a){var b,c;B.initializeObject(this),b=(c=this._batman).associationProxies||(c.associationProxies=new B.SimpleHash);return b.get(a.label)||b.set(a.label,new a.proxyClass(a,this))},i.accessor("id",{get:function(){var a;a=this.constructor.primaryKey;return a==="id"?this.id:this.get(a)},set:function(a,b){var c;typeof b=="string"&&b.match(/[^0-9]/)===null&&(b=parseInt(b,10)),c=this.constructor.primaryKey;return c==="id"?this.id=b:this.set(c,b)}}),i.accessor("dirtyKeys","errors",B.Property.defaultAccessor),i.accessor("batmanState",{get:function(){return this.state()},set:function(a,b){return this.state(b)}}),i.accessor(i.defaultAccessor={get:function(a){var b,c;b=((c=this._batman).attributes||(c.attributes={}))[a];return typeof b!="undefined"?b:this[a]},set:function(a,b){var c;return((c=this._batman).attributes||(c.attributes={}))[a]=b},unset:function(a){var b,c;b=((c=this._batman).attributes||(c.attributes={}))[a],delete this._batman.attributes[a];return b}}),i.prototype.set=function(a,b){var c,d,e;c=this.get(a);if(c!==b){d=i.__super__.set.apply(this,arguments),this.dirtyKeys.set(a,c),(e=this.state())!=="dirty"&&e!=="loading"&&e!=="creating"&&this.dirty();return d}},i.prototype.updateAttributes=function(a){this.mixin(a);return this},i.prototype.toString=function(){return""+h(this.constructor)+": "+this.get("id")},i.prototype.toJSON=function(){var a,b;b={},a=this._batman.get("encoders"),!!a&&!a.isEmpty()&&a.forEach(bf(function(a,c){var d,e;e=this.get(a);if(typeof e!="undefined"){d=c(e,a,b,this);if(typeof d!="undefined")return b[a]=d}},this));return b},i.prototype.fromJSON=function(a){var b,c,d,e;d={},b=this._batman.get("decoders");if(!b||b.isEmpty())for(c in a)e=a[c],d[c]=e;else b.forEach(bf(function(b,c){if(typeof a[b]!="undefined")return d[b]=c(a[b],b,a,d,this)},this));return this.mixin(d)},i.actsAsStateMachine(!0),f=["empty","dirty","loading","loaded","saving","saved","creating","created","validating","validated","destroying","destroyed"];for(b=0,d=f.length;b<d;b++)a=f[b],i.state(a);g=["loading","loaded"];for(c=0,e=g.length;c<e;c++)a=g[c],i.classState(a);i.prototype._doStorageOperation=function(a,b,c){var d,e,f,g;e=this._batman.get("storage");for(f=0,g=e.length;f<g;f++)d=e[f],d.perform(a,this,{data:b},c);return!0},i.prototype.hasStorage=function(){return(this._batman.get("storage")||[]).length>0},i.prototype.load=function(a){var b;if((b=this.state())==="destroying"||b==="destroyed")typeof a=="function"&&a(new Error("Can't load a destroyed record!"));else{this.loading();return this._doStorageOperation("read",{},bf(function(b,c){b||(this.loaded(),c=this.constructor._mapIdentity(c));return typeof a=="function"?a(b,c):void 0},this))}},i.prototype.save=function(a){var b;if((b=this.state())==="destroying"||b==="destroyed")typeof a=="function"&&a(new Error("Can't save a destroyed record!"));else return this.validate(bf(function(b,c){var d,e,f;if(!b)typeof a=="function"&&a(c);else{e=this.isNew(),this.saving(),e&&this.creating(),d=this.constructor._batman.get("associations"),d!=null&&(f=d.getByType("belongsTo"))!=null&&f.forEach(bf(function(a,b){return a.apply(this)},this));return this._doStorageOperation(e?"create":"update",{},bf(function(b,c){var f,g;b||(e&&this.created(),this.saved(),this.dirtyKeys.clear(),d!=null&&(f=d.getByType("hasOne"))!=null&&f.forEach(function(a){return a.apply(b,c)}),d!=null&&(g=d.getByType("hasMany"))!=null&&g.forEach(function(a){return a.apply(b,c)}),c=this.constructor._mapIdentity(c));return typeof a=="function"?a(b,c):void 0},this))}},this))},i.prototype.destroy=function(a){this.destroying();return this._doStorageOperation("destroy",{},bf(function(b,c){b||(this.constructor.get("all").remove(this),this.destroyed());return typeof a=="function"?a(b):void 0},this))},i.prototype.validate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;e=this.state(),this.errors.clear(),this.validating(),c=bf(function(){this.validated(),this[e]();return typeof a=="function"?a(this.errors.length===0,this.errors):void 0},this),i=this._batman.get("validators")||[];if(i.length>0){b=i.length,g=bf(function(){if(--b===0)return c()},this);for(j=0,l=i.length;j<l;j++){h=i[j],f=h.validator,n=h.keys;for(k=0,m=n.length;k<m;k++)d=n[k],f?f.validateEach(this.errors,this,d,g):h.callback(this.errors,this,d,g)}}else c()},i.prototype.isNew=function(){return typeof this.get("id")=="undefined"};return i}(),B.AssociationProxy=function(){function a(a,b){this.association=a,this.model=b}be(a,B.Object),a.prototype.isProxy=!0,a.prototype.loaded=!1,a.prototype.toJSON=function(){if(this.get("loaded"))return this.get("target").toJSON()},a.prototype.load=function(a){this.fetch(bf(function(b,c){b||this.set("target",c);return typeof a=="function"?a(b,c):void 0},this));return this.get("target")},a.accessor("loaded",B.Property.defaultAccessor),a.accessor("target",{get:function(){var a;if(a=this.model.get(this.association.localKey))return this.association.getRelatedModel().get("loaded").indexedByUnique("id").get(a)},set:function(a,b){return b}}),a.accessor({get:function(a){var b;return(b=this.get("target"))!=null?b.get(a):void 0},set:function(a,b){var c;return(c=this.get("target"))!=null?c.set(a,b):void 0}});return a}(),B.BelongsToProxy=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.AssociationProxy),a.prototype.fetch=function(a){var b,c;if(c=this.model.get(this.association.localKey)){b=this.association.setIndex().get(c);if(b!=null){this.set("loaded",!0);return a(void 0,b)}return this.association.getRelatedModel().find(c,bf(function(b,c){if(b)throw b;c&&this.set("loaded",!0);return a(void 0,c)},this))}};return a}(),B.HasOneProxy=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.AssociationProxy),a.prototype.fetch=function(a){var b,c,d;if(b=this.model.get(this.association.localKey)){d=this.association.setIndex().get(b);if(d!=null){this.set("loaded",!0);return a(void 0,d)}c={},c[this.association.foreignKey]=b;return this.association.getRelatedModel().load(c,bf(function(b,c){if(b)throw b;if(!c||c.length<=0)return a(new Error("Couldn't find related record!"),void 0);this.set("loaded",!0);return a(void 0,c[0])},this))}};return a}(),B.AssociationSet=function(){function a(b,c){var d;this.foreignKeyValue=b,this.association=c,d=new B.Set,a.__super__.constructor.call(this,d,"hashKey")}be(a,B.SetSort),a.prototype.loaded=!1,a.prototype.load=function(a){var b;if(this.foreignKeyValue==null)return a(void 0,this);b={},b[this.association.foreignKey]=this.foreignKeyValue;return this.association.getRelatedModel().load(b,bf(function(b,c){b||(this.loaded=!0);return a(b,this)},this))};return a}(),B.UniqueAssociationSetIndex=function(){function a(b){this.association=b,a.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),this.association.foreignKey)}be(a,B.UniqueSetIndex);return a}(),B.AssociationSetIndex=function(){function a(b){this.association=b,a.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),this.association.foreignKey)}be(a,B.SetIndex),a.prototype._resultSetForKey=function(a){return this._storage.getOrSet(a,bf(function(){return new B.AssociationSet(a,this.association)},this))},a.prototype._setResultSet=function(a,b){return this._storage.set(a,b)};return a}(),B.AssociationCurator=function(){function a(b){this.model=b,a.__super__.constructor.call(this),this._byTypeStorage=new B.SimpleHash}be(a,B.SimpleHash),a.availableAssociations=["belongsTo","hasOne","hasMany"],a.prototype.add=function(a){var b;this.set(a.label,a),(b=this._byTypeStorage.get(a.associationType))||(b=new B.SimpleSet,this._byTypeStorage.set(a.associationType,b));return b.add(a)},a.prototype.getByType=function(a){return this._byTypeStorage.get(a)},a.prototype.getByLabel=function(a){return this.get(a)},a.prototype.reset=function(){this.forEach(function(a,b){return b.reset()});return!0},a.prototype.merge=function(){var b,c;b=1<=arguments.length?bb.call(arguments,0):[],c=a.__super__.merge.apply(this,arguments),c._byTypeStorage=this._byTypeStorage.merge(b.map(function(a){return a._byTypeStorage}));return c};return a}(),B.Association=function(){function a(a,b,c){var d,e,f;this.model=a,this.label=b,c==null&&(c={}),d={namespace:B.currentApp,name:K.camelize(K.singularize(this.label))},this.options=m(d,this.defaultOptions,c),a.encode(b,this.encoder()),f=this,e=function(){return f.getAccessor.call(this,f,a,b)},a.accessor(b,{get:e,set:a.defaultAccessor.set,unset:a.defaultAccessor.unset}),this.url&&(a.url||(a.url=function(a){return f.url(a)}))}a.prototype.associationType="",a.prototype.defaultOptions={saveInline:!0,autoload:!0},a.prototype.getRelatedModel=function(){var a,b,c;c=this.options.namespace||B.currentApp,a=this.options.name,b=c!=null?c[a]:void 0;return b},a.prototype.getFromAttributes=function(a){return a.constructor.defaultAccessor.get.call(a,this.label)},a.prototype.setIntoAttributes=function(a,b){return a.constructor.defaultAccessor.set.call(a,this.label,b)},a.prototype.encoder=function(){},a.prototype.setIndex=function(){},a.prototype.inverse=function(){var a,b;if(b=this.getRelatedModel()._batman.get("associations")){if(this.options.inverseOf)return b.getByLabel(this.options.inverseOf);a=null,b.forEach(bf(function(b,c){if(c.getRelatedModel()===this.model)return a=c},this));return a}},a.prototype.reset=function(){delete this.index;return!0};return a}(),B.SingularAssociation=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Association),a.prototype.isSingular=!0,a.prototype.getAccessor=function(a,b,c){var d,e;if(e=a.getFromAttributes(this))return e;if(a.getRelatedModel()){d=this.associationProxy(a),B.Property.withoutTracking(function(){if(!d.get("loaded")&&a.options.autoload)return d.load()});return d}},a.prototype.setIndex=function(){this.index||(this.index=new B.UniqueAssociationSetIndex(this));return this.index};return a}(),B.PluralAssociation=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Association),a.prototype.isSingular=!1,a.prototype.setForRecord=function(a){return B.Property.withoutTracking(bf(function(){var b;return(b=a.get(this.localKey))?this.setIndex().get(b):new B.AssociationSet(void 0,this)},this))},a.prototype.getAccessor=function(a,b,c){var d,e;if(!!a.getRelatedModel()){if(e=a.getFromAttributes(this))return e;d=a.setForRecord(this),a.setIntoAttributes(this,d),B.Property.withoutTracking(bf(function(){if(a.options.autoload&&!this.isNew()&&!d.loaded)return d.load(function(a,b){if(a)throw a})},this));return d}},a.prototype.setIndex=function(){this.index||(this.index=new B.AssociationSetIndex(this));return this.index};return a}(),B.BelongsToAssociation=function(){function a(){a.__super__.constructor.apply(this,arguments),this.localKey=this.options.localKey||""+this.label+"_id",this.foreignKey=this.options.foreignKey||"id",this.model.encode(this.localKey)}be(a,B.SingularAssociation),a.prototype.associationType="belongsTo",a.prototype.proxyClass=B.BelongsToProxy,a.prototype.defaultOptions={saveInline:!1,autoload:!0},a.prototype.url=function(a){var b,c,d,e,f,g;if(e=this.inverse()){f=B.helpers.pluralize(this.label),d=(g=a.data)!=null?g[""+this.label+"_id"]:void 0,c=e.isSingular?"singularize":"pluralize",b=B.helpers[c](e.label);return"/"+f+"/"+d+"/"+b}},a.prototype.encoder=function(){var a;a=this;return{encode:function(b){if(!!a.options.saveInline)return b.toJSON()},decode:function(b,c,d,e,f){var g,h,i;i=a.getRelatedModel(),h=new i,h.fromJSON(b),h=i._mapIdentity(h),a.options.inverseOf&&(g=a.inverse())&&(g instanceof B.HasManyAssociation?f.set(a.localKey,h.get(a.foreignKey)):h.set(g.label,f)),f.set(a.label,h);return h}}},a.prototype.apply=function(a){var b,c;if(c=a.get(this.label)){b=c.get(this.foreignKey);if(b!==void 0)return a.set(this.localKey,b)}};return a}(),B.HasOneAssociation=function(){function a(){a.__super__.constructor.apply(this,arguments),this.localKey=this.options.localKey||"id",this.foreignKey=this.options.foreignKey||""+K.underscore(h(this.model))+"_id"}be(a,B.SingularAssociation),a.prototype.associationType="hasOne",a.prototype.proxyClass=B.HasOneProxy,a.prototype.apply=function(a,b){var c;if(c=this.getFromAttributes(b))return c.set(this.foreignKey,b.get(this.localKey))},a.prototype.encoder=function(){var a;a=this;return{encode:function(b,c,d,e){var f;if(!!a.options.saveInline){if(f=b.toJSON())f[a.foreignKey]=e.get(a.localKey);return f}},decode:function(b,c,d,e,f){var g,h;h=a.getRelatedModel(),g=new h,g.fromJSON(b),a.options.inverseOf&&g.set(a.options.inverseOf,f),g=h._mapIdentity(g);return g}}};return a}(),B.HasManyAssociation=function(){function a(){a.__super__.constructor.apply(this,arguments),this.localKey=this.options.localKey||"id",this.foreignKey=this.options.foreignKey||""+K.underscore(h(this.model))+"_id"}be(a,B.PluralAssociation),a.prototype.associationType="hasMany",a.prototype.apply=function(a,b){var c;if(!a){(c=this.getFromAttributes(b))&&c.forEach(bf(function(a){return a.set(this.foreignKey,b.get(this.localKey))},this));return b.set(this.label,this.setForRecord(b))}},a.prototype.encoder=function(){var a;a=this;return{encode:function(b,c,d,e){var f;if(!a._beingEncoded){a._beingEncoded=!0;if(!a.options.saveInline)return;b!=null&&(f=[],b.forEach(function(b){var c;c=b.toJSON(),c[a.foreignKey]=e.get(a.localKey);return f.push(c)})),delete a._beingEncoded;return f}},decode:function(b,c,d,e,f){var g,h,i,j,k,l,m,n;if(m=a.getRelatedModel()){i=a.getFromAttributes(f)||a.setForRecord(f),h=i!=null?i.toArray():void 0;for(j=0,n=b.length;j<n;j++)k=b[j],l=h&&h[j]?(g=!0,h[j]):(g=!1,new m),l.fromJSON(k),a.options.inverseOf&&l.set(a.options.inverseOf,f),l=m._mapIdentity(l),i.add(l)}return i}}};return a}(),Z=B.AssociationCurator.availableAssociations,S=bf(function(a){return B.Model[a]=function(b,c){var d,e;B.initializeObject(this),d=(e=this._batman).associations||(e.associations=new B.AssociationCurator(this));return d.add(new(B[""+K.capitalize(a)+"Association"])(this,b,c))}},this);for(T=0,W=Z.length;T<W;T++)M=Z[T],S(M);B.ValidationError=function(){function a(b,c){a.__super__.constructor.call(this,{attribute:b,message:c})}be(a,B.Object);return a}(),B.ErrorsSet=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Set),a.accessor(function(a){return this.indexedBy("attribute").get(a)}),a.prototype.add=function(b,c){return a.__super__.add.call(this,new B.ValidationError(b,c))};return a}(),B.Validator=function(){function a(){var b,c;c=arguments[0],b=2<=arguments.length?bb.call(arguments,1):[],this.options=c,a.__super__.constructor.apply(this,b)}be(a,B.Object),a.prototype.validate=function(a){},a.prototype.format=function(a,b,c){return O("errors.format",{attribute:a,message:O("errors.messages."+b,c)})},a.options=function(){var a;a=1<=arguments.length?bb.call(arguments,0):[],B.initializeObject(this);return this._batman.options?this._batman.options.concat(a):this._batman.options=a},a.matches=function(a){var b,c,d,e,f,g;c={},d=!1;for(b in a)e=a[b],~((f=this._batman)!=null?(g=f.options)!=null?g.indexOf(b):void 0:void 0)&&(c[b]=e,d=!0);if(d)return c};return a}(),D=B.Validators=[B.LengthValidator=function(){function a(b){var c;if(c=b.lengthIn||b.lengthWithin)b.minLength=c[0],b.maxLength=c[1]||-1,delete b.lengthWithin,delete b.lengthIn;a.__super__.constructor.apply(this,arguments)}be(a,B.Validator),a.options("minLength","maxLength","length","lengthWithin","lengthIn"),a.prototype.validateEach=function(a,b,c,d){var e,f,g;e=this.options,f=(g=b.get(c))!=null?g:[],e.minLength&&f.length<e.minLength&&a.add(c,this.format(c,"too_short",{count:e.minLength})),e.maxLength&&f.length>e.maxLength&&a.add(c,this.format(c,"too_long",{count:e.maxLength})),e.length&&f.length!==e.length&&a.add(c,this.format(c,"wrong_length",{count:e.length}));return d()};return a}(),B.PresenceValidator=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Validator),a.options("presence"),a.prototype.validateEach=function(a,b,c,d){var e;e=b.get(c),this.options.presence&&e==null&&a.add(c,this.format(c,"blank"));return d()};return a}()],m(B.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank"}}}),B.StorageAdapter=function(){function a(b){a.__super__.constructor.call(this,{model:b})}be(a,B.Object),a.StorageError=function(){function a(b){a.__super__.constructor.apply(this,arguments),this.message=b}be(a,Error),a.prototype.name="StorageError";return a}(),a.RecordExistsError=function(){function b(a){b.__super__.constructor.call(this,a||"Can't create this record because it already exists in the store!")}be(b,a.StorageError),b.prototype.name="RecordExistsError";return b}(),a.NotFoundError=function(){function b(a){b.__super__.constructor.call(this,a||"Record couldn't be found in storage!")}be(b,a.StorageError),b.prototype.name="NotFoundError";return b}(),a.prototype.isStorageAdapter=!0,a.prototype.storageKey=function(a){var b;b=(a!=null?a.constructor:void 0)||this.model;return b.get("storageKey")||K.pluralize(K.underscore(h(b)))},a.prototype.getRecordFromData=function(a,b){var c;b==null&&(b=this.model),c=new b,c.fromJSON(a);return c},a.skipIfError=function(a){return function(b,c){return b.error!=null?c():a.call(this,b,c)}},a.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(bb.call(arguments)))},a.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(bb.call(arguments)))},a.prototype._inheritFilters=function(){var a,b,c,d,e,f;if(!this._batman.check(this)||!this._batman.filters){d=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}};if(d!=null){f=[];for(e in d)a=d[e],f.push(function(){var d;d=[];for(c in a)b=a[c],d.push(this._batman.filters[e][c]=b.slice(0));return d}.call(this));return f}}},a.prototype._addFilter=function(){var a,b,c,d,e,f,g,h;d=arguments[0],c=3<=arguments.length?bb.call(arguments,1,f=arguments.length-1):(f=1,[]),a=arguments[f++],this._inheritFilters();for(g=0,h=c.length;g<h;g++)b=c[g],(e=this._batman.filters[d])[b]||(e[b]=[]),this._batman.filters[d][b].push(a);return!0},a.prototype.runFilter=function(a,b,c,d){var e,f,g,h;this._inheritFilters(),f=this._batman.filters[a].all||[],e=this._batman.filters[a][b]||[],c.action=b,g=e.concat(f),h=bf(function(a){var b;a!=null&&(c=a);return(b=g.shift())!=null?b.call(this,c,h):d.call(this,c)},this);return h()},a.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(bb.call(arguments)))},a.prototype.runAfterFilter=function(a,b,c){return this.runFilter("after",a,b,this.exportResult(c))},a.prototype.exportResult=function(a){return function(b){return a(b.error,b.result,b)}},a.prototype._jsonToAttributes=function(a){return JSON.parse(a)},a.prototype.perform=function(a,b,c,d){var e,f;c||(c={}),e={options:c},a==="readAll"?e.proto=b:e.record=b,f=bf(function(b){b!=null&&(e=b);return this.runAfterFilter(a,e,d)},this);return this.runBeforeFilter(a,e,function(b){return this[a](b,f)})};return a}(),B.LocalStorage=function(){function a(){if(typeof window.localStorage=="undefined")return null;a.__super__.constructor.apply(this,arguments),this.storage=localStorage}be(a,B.StorageAdapter),a.prototype.storageRegExpForRecord=function(a){return new RegExp("^"+this.storageKey(a)+"(\\d+)$")},a.prototype.nextIdForRecord=function(a){var b,c;c=this.storageRegExpForRecord(a),b=1,this._forAllStorageEntries(function(a,d){var e;if(e=c.exec(a))return b=Math.max(b,parseInt(e[1],10)+1)});return b},a.prototype._forAllStorageEntries=function(a){var b,c,d;for(b=0,d=this.storage.length;0<=d?b<d:b>d;0<=d?b++:b--)c=this.storage.key(b),a.call(this,c,this.storage.getItem(c));return!0},a.prototype._storageEntriesMatching=function(a,b){var c,d;c=this.storageRegExpForRecord(a),d=[],this._forAllStorageEntries(function(e,f){var g,h;if(h=c.exec(e)){g=this._jsonToAttributes(f),g[a.constructor.primaryKey]=h[1];if(this._dataMatches(b,g))return d.push(g)}});return d},a.prototype._dataMatches=function(a,b){var c,d,e;d=!0;for(c in a){e=a[c];if(b[c]!==e){d=!1;break}}return d},a.prototype.before("read","create","update","destroy",a.skipIfError(function(a,b){a.action==="create"?a.id=a.record.get("id")||a.record.set("id",this.nextIdForRecord(a.record)):a.id=a.record.get("id"),a.id==null?a.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+a.action+"!"):a.key=this.storageKey(a.record)+a.id;return b()})),a.prototype.before("create","update",a.skipIfError(function(a,b){a.recordAttributes=JSON.stringify(a.record);return b()})),a.prototype.after("read",a.skipIfError(function(a,b){if(typeof a.recordAttributes=="string")try{a.recordAttributes=this._jsonToAttributes(a.recordAttributes)}catch(c){a.error=c;return b()}a.record.fromJSON(a.recordAttributes);return b()})),a.prototype.after("read","create","update","destroy",a.skipIfError(function(a,b){a.result=a.record;return b()})),a.prototype.after("readAll",a.skipIfError(function(a,b){var c;a.result=a.records=function(){var b,d,e,f;e=a.recordsAttributes,f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(this.getRecordFromData(c,a.proto.constructor));return f}.call(this);return b()})),a.prototype.read=a.skipIfError(function(a,b){a.recordAttributes=this.storage.getItem(a.key),a.recordAttributes||(a.error=new this.constructor.NotFoundError);return b()}),a.prototype.create=a.skipIfError(function(a,b){var c,d;c=a.key,d=a.recordAttributes,this.storage.getItem(c)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(c,d);return b()}),a.prototype.update=a.skipIfError(function(a,b){var c,d;c=a.key,d=a.recordAttributes,this.storage.setItem(c,d);return b()}),a.prototype.destroy=a.skipIfError(function(a,b){var c;c=a.key,this.storage.removeItem(c);return b()}),a.prototype.readAll=a.skipIfError(function(a,b){var c,d;d=a.proto,c=a.options;try{arguments[0].recordsAttributes=this._storageEntriesMatching(d,c.data)}catch(e){arguments[0].error=e}return b()});return a}(),B.SessionStorage=function(){function a(){if(typeof window.sessionStorage=="undefined")return null;a.__super__.constructor.apply(this,arguments),this.storage=sessionStorage}be(a,B.LocalStorage);return a}(),B.RestStorage=function(){function f(){f.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=m({},this.defaultRequestOptions)}var a,b,c,d,e;be(f,B.StorageAdapter),f.JSONContentType="application/json",f.PostBodyContentType="application/x-www-form-urlencoded",f.prototype.defaultRequestOptions={type:"json"},f.prototype.serializeAsForm=!0,f.prototype.recordJsonNamespace=function(a){return K.singularize(this.storageKey(a))},f.prototype.collectionJsonNamespace=function(a){return K.pluralize(this.storageKey(a))},f.prototype._execWithOptions=function(a,b,c){return typeof a[b]=="function"?a[b](c):a[b]},f.prototype._defaultCollectionUrl=function(a){return"/"+this.storageKey(a)},f.prototype.urlForRecord=function(a,b){var c,d;if(a.url)d=this._execWithOptions(a,"url",b.options);else{d=a.constructor.url?this._execWithOptions(a.constructor,"url",b.options):this._defaultCollectionUrl(a);if(b.action!=="create")if((c=a.get("id"))!=null)d=d+"/"+c;else throw new this.constructor.StorageError("Couldn't get/set record primary key on "+b.action+"!")}return d},f.prototype.urlForCollection=function(a,b){return a.url?this._execWithOptions(a,"url",b.options):this._defaultCollectionUrl(a.prototype,b.options)},f.prototype.request=function(a,b){var c,d;c=m(a.options,{success:function(b){return a.data=b},error:function(b){return a.error=b},loaded:function(){a.response=d.get("response");return b()}});return d=new B.Request(c)},f.prototype.perform=function(a,b,c,d){m(c||(c={}),this.defaultRequestOptions);return f.__super__.perform.apply(this,arguments)},f.prototype.before("create","read","update","destroy",f.skipIfError(function(a,b){try{a.options.url=this.urlForRecord(a.record,a)}catch(c){a.error=c}return b()})),f.prototype.before("readAll",f.skipIfError(function(a,b){try{a.options.url=this.urlForCollection(a.proto.constructor,a)}catch(c){a.error=c}return b()})),f.prototype.before("create","update",f.skipIfError(function(a,b){var c,d,e;d=a.record.toJSON(),(e=this.recordJsonNamespace(a.record))?(c={},c[e]=d):c=d,this.serializeAsForm?a.options.contentType=this.constructor.PostBodyContentType:(c=JSON.stringify(c),a.options.contentType=this.constructor.JSONContentType),a.options.data=c;return b()})),f.prototype.after("create","read","update",f.skipIfError(function(a,b){var c,d;if(typeof a.data=="string")try{c=this._jsonToAttributes(a.data)}catch(e){a.error=e;return b()}else c=a.data;d=this.recordJsonNamespace(a.record),d&&c[d]!=null&&(c=c[d]),a.record.fromJSON(c),a.result=a.record;return b()})),f.prototype.after("readAll",f.skipIfError(function(a,b){var c,d;if(typeof a.data=="string")try{a.data=JSON.parse(a.env)}catch(e){a.error=e;return b()}d=this.collectionJsonNamespace(a.proto),a.recordsAttributes=d&&a.data[d]!=null?a.data[d]:a.data,a.result=a.records=function(){var b,d,e,f;e=a.recordsAttributes,f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(this.getRecordFromData(c,a.proto.constructor));return f}.call(this);return b()})),f.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},e=["create","read","update","destroy","readAll"],b=bf(function(a){return this.prototype[a]=this.skipIfError(function(b,c){b.options.method=this.constructor.HTTPMethods[a];return this.request(b,c)})},f);for(c=0,d=e.length;c<d;c++)a=e[c],b(a);return f}.call(this),B.ViewStore=function(){function a(){a.__super__.constructor.apply(this,arguments),this._viewContents={},this._requestedPaths=new B.SimpleSet}be(a,B.Object),a.prefix="views",a.prototype.propertyClass=B.Property,a.prototype.fetchView=function(a){return new B.Request({url:B.Navigator.normalizePath(this.constructor.prefix,""+a+".html"),type:"html",success:bf(function(b){return this.set(a,b)},this),error:function(b){throw new Error("Could not load view from "+a)}})},a.accessor({"final":!0,get:function(a){if(a[0]!=="/")return this.get("/"+a);if(this._viewContents[a])return this._viewContents[a];this._requestedPaths.has(a)||this.fetchView(a)},set:function(a,b){if(a[0]!=="/")return this.set("/"+a,b);this._requestedPaths.add(a);return this._viewContents[a]=b}}),a.prototype.prefetch=function(a){this.get(a);return!0};return a}(),B.View=function(){function a(){a.__super__.constructor.apply(this,arguments),B.Property.withoutTracking(bf(function(){var a;return(a=this.get("node"))?this.render(a):this.observe("node",bf(function(a){return this.render(a)},this))},this))}be(a,B.Object),a.prototype.isView=!0,a.store=new B.ViewStore,a.prototype.source="",a.prototype.html="",a.prototype.node=null,a.prototype.event("ready").oneShot=!0,a.accessor("html",{get:function(){var a;if(this.html&&this.html.length>0)return this.html;if(!!(a=this.get("source"))){a=B.Navigator.normalizePath(a);return this.html=this.constructor.store.get(a)}},set:function(a,b){return this.html=b}}),a.accessor("node",{get:function(){var a;if(!this.node){a=this.get("html");if(!(a&&a.length>0))return;this.hasContainer=!0,this.node=document.createElement("div"),u(this.node,a),B.data(this.node.children[0],"view",this)}return this.node},set:function(a,b){var c;this.node=b,B.data(this.node,"view",this),c=bf(function(a){if(a!=null){u(this.get("node"),a);return this.forget("html",c)}},this);return this.observeAndFire("html",c)}}),a.prototype.render=function(a){var b;this.event("ready").resetOneShot(),(b=this._renderer)!=null&&b.forgetAll();if(a){this._renderer=new B.Renderer(a,null,this.context,this);return this._renderer.on("rendered",bf(function(){return this.fire("ready",a)},this))}};return a}(),B.Renderer=function(){function m(a,b,c,d){this.node=a,this.resume=bf(this.resume,this),this.start=bf(this.start,this),m.__super__.constructor.call(this),b!=null&&this.on("parsed",b),this.context=c instanceof B.RenderContext?c:B.RenderContext.start(c),d&&(this.context=this.context.descend(d)),this.immediate=t(this.start)}var a,b,d,e,f,h,i,j,k,l;be(m,B.Object),m.prototype.deferEvery=50,m.prototype.start=function(){this.startTime=new Date;return this.parseNode(this.node)},m.prototype.resume=function(){this.startTime=new Date;return this.parseNode(this.resumeNode)},m.prototype.finish=function(){this.startTime=null,this.prevent("stopped"),this.fire("parsed");return this.fire("rendered")},m.prototype.stop=function(){c(this.immediate);return this.fire("stopped")},m.prototype.forgetAll=function(){},l=["parsed","rendered","stopped"];for(i=0,j=l.length;i<j;i++)e=l[i],m.prototype.event(e).oneShot=!0;a=/^data\-(.*)/,b=["renderif","foreach","formfor","context","bind","source","target"],d={};for(h=0,k=b.length;h<k;h++)f=b[h],d[f]=h;m.prototype._sortBindings=function(a,c){var e,f;e=d[a[0]],f=d[c[0]],e==null&&(e=b.length),f==null&&(f=b.length);return e>f?1:f>e?-1:a[0]>c[0]?1:c[0]>a[0]?-1:0},m.prototype.parseNode=function(b){var c,d,e,g,h,i,j,k,l,m,n,p,q,r,s,u;if(this.deferEvery&&new Date-this.startTime>this.deferEvery)this.resumeNode=b,this.timeout=t(this.resume);else{if(b.getAttribute&&b.attributes){d=function(){var d,e,g,h,i;g=b.attributes,i=[];for(d=0,e=g.length;d<e;d++){c=g[d],f=(h=c.nodeName.match(a))!=null?h[1]:void 0;if(!f)continue;i.push(~(l=f.indexOf("-"))?[f.substr(0,l),f.substr(l+1),c.value]:[f,c.value])}return i}(),u=d.sort(this._sortBindings);for(p=0,q=u.length;p<q;p++){i=u[p],e=i[1],j=i.length===2?typeof (m=B.DOM.readers)[r=i[0]]=="function"?m[r](b,e,this.context,this):void 0:typeof (n=B.DOM.attrReaders)[s=i[0]]=="function"?n[s](b,e,i[2],this.context,this):void 0;if(j===!1){k=!0;break}j instanceof B.RenderContext&&(h=this.context,this.context=j,o(b,bf(function(){return this.context=h},this)))}}return(g=this.nextNode(b,k))?this.parseNode(g):this.finish()}},m.prototype.nextNode=function(a,b){var c,d,e,f;if(!b){c=a.childNodes;if(c!=null?c.length:void 0)return c[0]}f=a.nextSibling,o(a).forEach(function(a){return a()}),g(a);if(this.node!==a){if(f)return f;d=a;while(d=d.parentNode){o(d).forEach(function(a){return a()}),g(d);if(this.node===d)return;e=d.nextSibling;if(e)return e}}};return m}(),B.RenderContext=function(){function b(a,b){this.object=a,this.parent=b}var a;b.start=function(a){var b;this.windowWrapper||(this.windowWrapper={window:B.container}),b=new this(this.windowWrapper),B.currentApp&&(b=b.descend(B.currentApp)),a&&(b=b.descend(a));return b},b.deProxy=function(a){return a!=null&&a.isContextProxy?a.get("proxiedObject"):a},b.prototype.findKey=function(a){var b,c,d;b=a.split(".")[0].split("|")[0].trim(),c=this;while(c){d=i(c.object,b);if(typeof d!="undefined"){d=i(c.object,a);return[d,c.object].map(this.constructor.deProxy)}c=c.parent}this.windowWrapper||(this.windowWrapper={window:B.container});return[i(this.windowWrapper,a),this.windowWrapper]},b.prototype.get=function(a){return this.findKey(a)[0]},b.prototype.descend=function(a,b){var c;b&&(c=a,a=new B.Object,a[b]=c);return new this.constructor(a,this)},b.prototype.descendWithKey=function(b,c){var d;d=new a(this,b);return this.descend(d,c)},b.prototype.chain=function(){var a,b;b=[],a=this;while(a)b.push(a.object),a=a.parent;return b},b.ContextProxy=a=function(){function a(a,b,c){this.renderContext=a,this.keyPath=b,this.localKey=c,this.binding=new B.DOM.AbstractBinding(void 0,this.keyPath,this.renderContext)}be(a,B.Object),a.prototype.isContextProxy=!0,a.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),a.accessor({get:function(a){return this.get("proxiedObject."+a)},set:function(a,b){return this.set("proxiedObject."+a,b)},unset:function(a){return this.unset("proxiedObject."+a)}});return a}();return b}.call(this),B.DOM={readers:{target:function(a,b,c,d){B.DOM.readers.bind(a,b,c,d,"nodeChange");return!0},source:function(a,b,c,d){B.DOM.readers.bind(a,b,c,d,"dataChange");return!0},bind:function(a,b,c,d,e){var f;f=!1;switch(a.nodeName.toLowerCase()){case"input":switch(a.getAttribute("type")){case"checkbox":B.DOM.attrReaders.bind(a,"checked",b,c,d,e);return!0;case"radio":f=B.DOM.RadioBinding;break;case"file":f=B.DOM.FileBinding}break;case"select":f=B.DOM.SelectBinding}f||(f=B.DOM.Binding),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(f,arguments,function(){});return!0},context:function(a,b,c,d){return c.descendWithKey(b)},mixin:function(a,b,c,d){new B.DOM.MixinBinding(a,b,c.descend(B.mixins),d);return!0},showif:function(a,b,c,d,e){new B.DOM.ShowHideBinding(a,b,c,d,!1,e);return!0},hideif:function(){var a;return(a=B.DOM.readers).showif.apply(a,bb.call(arguments).concat([!0]))},route:function(){(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d})(B.DOM.RouteBinding,arguments,function(){});return!0},view:function(){(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d})(B.DOM.ViewBinding,arguments,function(){});return!1},partial:function(a,b,c,d){B.DOM.partial(a,b,c,d);return!0},defineview:function(a,b,c,d){o(a,function(){return s(a)}),B.View.store.set(B.Navigator.normalizePath(b),a.innerHTML);return!1},renderif:function(a,b,c,d){new B.DOM.DeferredRenderingBinding(a,b,c,d);return!1},yield:function(a,b){t(function(){return B.DOM.yield(b,a)});return!0},contentfor:function(a,b){t(function(){return B.DOM.contentFor(b,a)});return!0},replace:function(a,b){t(function(){return B.DOM.replace(b,a)});return!0}},_yielders:{},_yields:{},attrReaders:{_parseAttribute:function(a){a==="false"&&(a=!1),a==="true"&&(a=!0);return a},source:function(a,b,c,d,e){return B.DOM.attrReaders.bind(a,b,c,d,e,"dataChange")},bind:function(a,b,c,d,e,f){var g;g=function(){switch(b){case"checked":case"disabled":case"selected":return B.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return B.DOM.NodeAttributeBinding;case"class":return B.DOM.ClassBinding;case"style":return B.DOM.StyleBinding;default:return B.DOM.AttributeBinding}}(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(g,arguments,function(){});return!0},context:function(a,b,c,d){return d.descendWithKey(c,b)},event:function(a,b,c,d){(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d})(B.DOM.EventBinding,arguments,function(){});return!0},addclass:function(a,b,c,d,e,f){new B.DOM.AddClassBinding(a,b,c,d,e,!1,f);return!0},removeclass:function(a,b,c,d,e){return B.DOM.attrReaders.addclass(a,b,c,d,e,!0)},foreach:function(a,b,c,d,e){(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d})(B.DOM.IteratorBinding,arguments,function(){});return!1},formfor:function(a,b,c,d){B.DOM.events.submit(a,function(a,b){return p(b)});return d.descendWithKey(c,b)},view:function(a,b,c,d){var e,f,g,h;h=d.findKey(c),g=h[0],e=h[1],f=null;return e.observeAndFire(c,function(c){f||(f=B.data(a,"view"));return f!=null?f.set(b,c):void 0})}},events:{click:function(b,c,d,e){e==null&&(e="click"),a(b,e,function(){var a;a=1<=arguments.length?bb.call(arguments,0):[],c.apply(null,[b].concat(bb.call(a),[d]));return p(a[0])}),b.nodeName.toUpperCase()==="A"&&!b.href&&(b.href="#");return b},doubleclick:function(a,b,c){return B.DOM.events.click(a,b,c,"dblclick")},change:function(b,c){var d,e,f,g,h,i;e=function(){switch(b.nodeName.toUpperCase()){case"TEXTAREA":return["keyup","change"];case"INPUT":if(b.type.toUpperCase()==="TEXT"){f=c,c=function(a){var b;if(!(a.type==="keyup"&&13<=(b=a.keyCode)&&b<=14))return f.apply(null,arguments)};return["keyup","change"]}return["change"];default:return["change"]}}(),i=[];for(g=0,h=e.length;g<h;g++)d=e[g],i.push(a(b,d,function(){var a;a=1<=arguments.length?bb.call(arguments,0):[];return c.apply(null,[b].concat(bb.call(a)))}));return i},submit:function(b,c){var d;d=function(a){return a.keyCode===13||a.which===13||a.keyIdentifier==="Enter"||a.key==="Enter"},B.DOM.nodeIsEditable(b)?(a(b,"keydown",function(){var a;a=1<=arguments.length?bb.call(arguments,0):[];if(d(a[0]))return B.DOM._keyCapturingNode=b}),a(b,"keyup",function(){var a;a=1<=arguments.length?bb.call(arguments,0):[];if(d(a[0])){B.DOM._keyCapturingNode===b&&(p(a[0]),c.apply(null,[b].concat(bb.call(a))));return B.DOM._keyCapturingNode=null}})):a(b,"submit",function(){var a;a=1<=arguments.length?bb.call(arguments,0):[],p(a[0]);return c.apply(null,[b].concat(bb.call(a)))});return b},other:function(b,c,d){return a(b,c,function(){var a;a=1<=arguments.length?bb.call(arguments,0):[];return d.apply(null,[b].concat(bb.call(a)))})}},yield:function(a,b){var c,d,e,f,g;B.DOM._yields[a]=b;if(d=B.DOM._yielders[a]){g=[];for(e=0,f=d.length;e<f;e++)c=d[e],g.push(c(b));return g}},contentFor:function(a,c,d,e){var f,g,h;h=B.DOM._yields[a],h&&l(h,c)&&(c=c.cloneNode(!0)),g=function(f){var g,h,i,j,k;if(d||!B._data(f,"yielded")){k=f.children;for(i=0,j=k.length;i<j;i++)g=k[i],B.DOM.didRemoveNode(g);u(f,"",!0)}if(e)while(c.childNodes.length>0)g=c.childNodes[0],h=B.data(g,"view"),h!=null&&typeof h.viewWillAppear=="function"&&h.viewWillAppear(g),b(f,c.childNodes[0],!0),h!=null&&typeof h.viewDidAppear=="function"&&h.viewDidAppear(g);else h=B.data(c,"view"),h!=null&&h.viewWillAppear(g),b(f,c,!0),h!=null&&h.viewDidAppear(g);B._data(c,"yielded",!0),B._data(f,"yielded",!0);return delete B.DOM._yielders[a]},(f=B.DOM._yielders[a])?f.push(g):B.DOM._yielders[a]=[g];if(h)return B.DOM.yield(a,h)},replace:function(a,b,c){return B.DOM.contentFor(a,b,!0,c)},partial:function(a,c,d,e){var f;e.prevent("rendered"),f=new B.View({source:c,context:d});return f.on("ready",function(){var c,d,g,h,i;u(a,""),d=function(){var a,b,c,d;c=f.get("node").childNodes,d=[];for(a=0,b=c.length;a<b;a++)g=c[a],d.push(g);return d}();for(h=0,i=d.length;h<i;h++)c=d[h],b(a,c);return e.allowAndFire("rendered")})},trackBinding:w=function(a,b){var c;return(c=B._data(b,"bindings"))?c.add(a):B._data(b,"bindings",new B.SimpleSet(a))},unbindNode:y=function(a){var b,c,d,e;(b=B._data(a,"bindings"))&&b.forEach(function(a){return a.die()});if(e=B._data(a,"listeners"))for(d in e)c=e[d],c.forEach(function(b){return r(a,d,b)});B.removeData(a);return B.removeData(a,void 0,!0)},unbindTree:z=function(a,b){var c,d,e,f,g;b==null&&(b=!0),b&&y(a),f=a.childNodes,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(z(c));return g},setInnerHTML:u=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=arguments[1],a=3<=arguments.length?bb.call(arguments,2):[],h=e.childNodes;for(f=0,g=h.length;f<g;f++)b=h[f],(c=B.data(b,"hide"))&&c.apply(b,a);z(e,!1);return e!=null?e.innerHTML=d:void 0},setStyleProperty:v=function(a,b,c,d){return a.style.setAttribute?a.style.setAttribute(b,c,d):a.style.setProperty(b,c,d)},removeNode:s=function(a){var b;(b=a.parentNode)!=null&&b.removeChild(a);return B.DOM.didRemoveNode(a)},appendChild:b=function(){var a,b,c,d,e;c=arguments[0],b=arguments[1],a=3<=arguments.length?bb.call(arguments,2):[],d=B.data(b,"view"),d!=null&&typeof d.viewWillAppear=="function"&&d.viewWillAppear(b),(e=B.data(b,"show"))!=null&&e.apply(b,a),c.appendChild(b);return d!=null?typeof d.viewDidAppear=="function"?d.viewDidAppear(b):void 0:void 0},insertBefore:k=function(a,c,d){d==null&&(d=null);return!d||a.childNodes.length<=0?b(a,c):a.insertBefore(c,d)},valueForNode:function(a,b){var c;b==null&&(b=""),c=arguments.length>1;switch(a.nodeName.toUpperCase()){case"INPUT":return c?a.value=b:a.value;case"TEXTAREA":return c?a.innerHTML=a.value=b:a.innerHTML;case"SELECT":return a.value=b;default:return c?u(a,b):a.innerHTML}},nodeIsEditable:function(a){var b;return(b=a.nodeName.toUpperCase())==="INPUT"||b==="TEXTAREA"||b==="SELECT"},addEventListener:a=function(a,b,c){var d;(d=B._data(a,"listeners"))||(d=B._data(a,"listeners",{})),d[b]||(d[b]=new B.Set),d[b].add(c);return j?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeEventListener:r=function(a,b,c){var d,e;(e=B._data(a,"listeners"))&&(d=e[b])&&d.remove(c);return j?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},hasAddEventListener:j=typeof window!="undefined"&&window!==null?!!window.addEventListener:!!void 0,didRemoveNode:function(a){var b;b=B.data(a,"view"),b!=null&&typeof b.viewWillDisappear=="function"&&b.viewWillDisappear(a),z(a);return b!=null?typeof b.viewDidDisappear=="function"?b.viewDidDisappear(a):void 0:void 0},onParseExit:o=function(a,b){var c;c=B._data(a,"onParseExit")||B._data(a,"onParseExit",new B.SimpleSet),b!=null&&c.add(b);return c},forgetParseExit:g=function(a,b){return B.removeData(a,"onParseExit",!0)}},B.DOM.AbstractBinding=function(){function d(a,b,c,d,e){this.node=a,this.keyPath=b,this.renderContext=c,this.renderer=d,this.only=e!=null?e:!1,this._fireDataChange=bf(this._fireDataChange,this),this._fireNodeChange=bf(this._fireNodeChange,this),this.node!=null&&B.DOM.trackBinding(this,this.node),this.parseFilter(),this.bindImmediately&&this.bind()}var a,b,c;be(d,B.Object),c=/(^|,)\s*(?!(?:true|false)\s*(?:$|,))([a-zA-Z][\w\.]*[\?\!]?)\s*(?=$|,)/g,a=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,b=/(?!^\s*)\[(.*?)\]/g,d.accessor("filteredValue",{get:function(){var a,b,c;c=this.get("unfilteredValue"),b=this;if(this.filterFunctions.length>0){a=this.filterFunctions.reduce(function(a,c,d){var e;e=b.filterArguments[d].map(function(a){return a._keypath?b.renderContext.get(a._keypath):a}),e.unshift(a);return c.apply(b.renderContext,e)},c);return a}return c},set:function(a,b){return this.set("unfilteredValue",b)}}),d.accessor("unfilteredValue",{get:function(){return(M=this.get("key"))?B.RenderContext.deProxy(this.get("keyContext."+M)):this.get("value")},set:function(a,b){var c;if(!(M=this.get("key")))return this.set("value",b);c=this.get("keyContext");if(c!==B.container)return this.set("keyContext."+M,b)}}),d.accessor("keyContext",function(){return this.renderContext.findKey(this.key)[1]}),d.prototype.bindImmediately=!0,d.prototype.shouldSet=!0,d.prototype.isTwoWay=function(){return this.key!=null&&this.filterFunctions.length===0},d.prototype.bind=function(){var a,b;this.node!=null&&((a=this.only)===!1||a==="nodeChange")&&B.DOM.nodeIsEditable(this.node)&&(B.DOM.events.change(this.node,this._fireNodeChange),this.only==="nodeChange"&&this._fireNodeChange());if((b=this.only)===!1||b==="dataChange")return this.observeAndFire("filteredValue",this._fireDataChange)},d.prototype._fireNodeChange=function(){this.shouldSet=!1,typeof this.nodeChange=="function"&&this.nodeChange(this.node,this.value||this.get("keyContext"));return this.shouldSet=!0},d.prototype._fireDataChange=function(a){if(this.shouldSet)return typeof this.dataChange=="function"?this.dataChange(a,this.node):void 0},d.prototype.die=function(){var a;this.forget();return(a=this._batman.properties)!=null?a.forEach(function(a,b){return b.die()}):void 0},d.prototype.parseFilter=function(){var c,d,e,f,g,h,i,j,k,l;this.filterFunctions=[],this.filterArguments=[],i=this.keyPath;while(a.test(i))i=i.replace(a,"]['$1']");g=i.replace(b," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{h=this.parseSegment(j=g.shift())[0]}catch(m){}h&&h._keypath?this.key=h._keypath:this.value=h;if(g.length){l=[];while(f=g.shift())k=f.indexOf(" "),~k?(e=f.substr(0,k),c=f.substr(k)):e=f,l.push(function(){if(d=B.Filters[e]){this.filterFunctions.push(d);if(!c)return this.filterArguments.push([]);try{return this.filterArguments.push(this.parseSegment(c))}catch(a){}}}.call(this));return l}},d.prototype.parseSegment=function(a){return JSON.parse("["+a.replace(c,'$1{"_keypath": "$2"}')+"]")};return d}(),B.DOM.AbstractAttributeBinding=function(){function a(){var b,c,d;d=arguments[0],c=arguments[1],b=3<=arguments.length?bb.call(arguments,2):[],this.attributeName=c,a.__super__.constructor.apply(this,[d].concat(bb.call(b)))}be(a,B.DOM.AbstractBinding);return a}(),B.DOM.AbstractCollectionBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractAttributeBinding),a.prototype.bindCollection=function(a){if(a!==this.collection){this.unbindCollection(),this.collection=a;if(this.collection){if(this.collection.isObservable&&this.collection.toArray)this.collection.observe("toArray",this.handleArrayChanged);else if(this.collection.isEventEmitter)this.collection.on("itemsWereAdded",this.handleItemsWereAdded),this.collection.on("itemsWereRemoved",this.handleItemsWereRemoved);else return!1;return!0}}return!1},a.prototype.unbindCollection=function(){if(this.collection){if(this.collection.isObservable&&this.collection.toArray)return this.collection.forget("toArray",this.handleArrayChanged);if(this.collection.isEventEmitter){this.collection.event("itemsWereAdded").removeHandler(this.handleItemsWereAdded);return this.collection.event("itemsWereRemoved").removeHandler(this.handleItemsWereRemoved)}}},a.prototype.handleItemsWereAdded=function(){},a.prototype.handleItemsWereRemoved=function(){},a.prototype.handleArrayChanged=function(){},a.prototype.die=function(){this.unbindCollection();return a.__super__.die.apply(this,arguments)};return a}(),B.DOM.Binding=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractBinding),a.prototype.nodeChange=function(a,b){if(this.isTwoWay())return this.set("filteredValue",this.node.value)},a.prototype.dataChange=function(a,b){return B.DOM.valueForNode(this.node,a)};return a}(),B.DOM.AttributeBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractAttributeBinding),a.prototype.dataChange=function(a){return this.node.setAttribute(this.attributeName,a)},a.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",B.DOM.attrReaders._parseAttribute(a.getAttribute(this.attributeName)))};return a}(),B.DOM.NodeAttributeBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractAttributeBinding),a.prototype.dataChange=function(a){a==null&&(a="");return this.node[this.attributeName]=a},a.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",B.DOM.attrReaders._parseAttribute(a[this.attributeName]))};return a}(),B.DOM.ShowHideBinding=function(){function a(b,c,d,e,f,g){var h;this.invert=g!=null?g:!1,h=b.style.display;if(!h||h==="none")h="";this.originalDisplay=h,a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractBinding),a.prototype.dataChange=function(a){var b,c,d;c=B.data(this.node,"view");if(!!a==!this.invert){c!=null&&typeof c.viewWillAppear=="function"&&c.viewWillAppear(this.node),(d=B.data(this.node,"show"))!=null&&d.call(this.node),this.node.style.display=this.originalDisplay;return c!=null?typeof c.viewDidAppear=="function"?c.viewDidAppear(this.node):void 0:void 0}c!=null&&typeof c.viewWillDisappear=="function"&&c.viewWillDisappear(this.node),typeof (b=B.data(this.node,"hide"))=="function"?b.call(this.node):v(this.node,"display","none","important");return c!=null?typeof c.viewDidDisappear=="function"?c.viewDidDisappear(this.node):void 0:void 0};return a}(),B.DOM.CheckedBinding=function(){function a(){a.__super__.constructor.apply(this,arguments),B._data(this.node,this.attributeName,this)}be(a,B.DOM.NodeAttributeBinding),a.prototype.dataChange=function(a){var b;this.node[this.attributeName]=!!a;return typeof (b=B._data(this.node.parentNode,"updateBinding"))=="function"?b():void 0};return a}(),B.DOM.ClassBinding=function(){function a(){this.handleItemsWereAdded=bf(this.handleItemsWereAdded,this),this.handleItemsWereRemoved=bf(this.handleItemsWereRemoved,this),this.handleArrayChanged=bf(this.handleArrayChanged,this),a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractCollectionBinding),a.prototype.dataChange=function(a){if(a!=null){this.unbindCollection();if(typeof a=="string")return this.node.className=a;this.bindCollection(a);return this.updateFromCollection()}},a.prototype.updateFromCollection=function(){var a,b,c;if(this.collection){a=this.collection.map?this.collection.map(function(a){return a}):function(){var a,d;a=this.collection,d=[];for(b in a){if(!bc.call(a,b))continue;c=a[b],d.push(b)}return d}.call(this),a.toArray!=null&&(a=a.toArray());return this.node.className=a.join(" ")}},a.prototype.handleArrayChanged=function(){return this.updateFromCollection()},a.prototype.handleItemsWereRemoved=function(){return this.updateFromCollection()},a.prototype.handleItemsWereAdded=function(){return this.updateFromCollection()};return a}(),B.DOM.DeferredRenderingBinding=function(){function a(){a.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-renderif")}be(a,B.DOM.AbstractBinding),a.prototype.rendered=!1,a.prototype.nodeChange=function(){},a.prototype.dataChange=function(a){if(a&&!this.rendered)return this.render()},a.prototype.render=function(){new B.Renderer(this.node,null,this.renderContext);return this.rendered=!0};return a}(),B.DOM.AddClassBinding=function(){function a(b,c,d,e,f,g,h){this.invert=h!=null?h:!1,this.className=c.replace(/\|/g," "),a.__super__.constructor.apply(this,arguments),delete this.attributeName}be(a,B.DOM.AbstractAttributeBinding),a.prototype.dataChange=function(a){var b,c;b=this.node.className,c=b.indexOf(this.className)!==-1;if(!!a==!this.invert){if(!c)return this.node.className=""+b+" "+this.className}else if(c)return this.node.className=b.replace(this.className,"")};return a}(),B.DOM.EventBinding=function(){function a(b,c,d,e){var f,g,h;a.__super__.constructor.apply(this,arguments),h=this.node.getAttribute("data-confirm"),g=bf(function(){var a;if(!h||!!confirm(h))return(a=this.get("filteredValue"))!=null?a.apply(this.get("callbackContext"),arguments):void 0},this),(f=B.DOM.events[this.attributeName])?f(this.node,g,e):B.DOM.events.other(this.node,this.attributeName,g)}be(a,B.DOM.AbstractAttributeBinding),a.prototype.bindImmediately=!1,a.accessor("callbackContext",function(){var a;a=this.key.split("."),a.pop();return a.length>0?this.get("keyContext").get(a.join(".")):this.get("keyContext")});return a}(),B.DOM.RadioBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractBinding),a.prototype.dataChange=function(a){var b;if((b=this.get("filteredValue"))!=null)return this.node.checked=b===this.node.value;if(this.node.checked)return this.set("filteredValue",this.node.value)},a.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",B.DOM.attrReaders._parseAttribute(a.value))};return a}(),B.DOM.FileBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractBinding),a.prototype.nodeChange=function(a,b){var c,d,e,f,g,h,i;if(!!this.isTwoWay()){f=this.key.split("."),f.length>1?e=b.get(f.slice(0,-1).join(".")):e=b,c=B.RenderContext.deProxy(e);if(c.hasStorage&&c.hasStorage()){i=c._batman.get("storage");for(g=0,h=i.length;g<h;g++)d=i[g],d instanceof B.RestStorage&&(d.defaultRequestOptions.formData=!0)}return a.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(a.files)):this.set("filteredValue",a.files[0])}},a.prototype.dataChange=function(a){return this.node.value=a};return a}(),B.DOM.MixinBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractBinding),a.prototype.dataChange=function(a){if(a!=null)return m(this.node,a)};return a}(),B.DOM.SelectBinding=function(){function a(){this.updateOptionBindings=bf(this.updateOptionBindings,this),this.updateSelectBinding=bf(this.updateSelectBinding,this),this.nodeChange=bf(this.nodeChange,this),this.dataChange=bf(this.dataChange,this),a.__super__.constructor.apply(this,arguments),this.renderer.on("rendered",bf(function(){if(this.node!=null){B._data(this.node,"updateBinding",this.updateSelectBinding);return this.bind()}},this))}be(a,B.DOM.AbstractBinding),a.prototype.bindImmediately=!1,a.prototype.firstBind=!0,a.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(a instanceof Array){f={},m=this.node.children;for(g=0,j=m.length;g<j;g++)b=m[g],b.selected=!1,d=f[b.value],d?d.push(b):d=[b],f[b.value]=d;for(h=0,k=a.length;h<k;h++){e=a[h],n=f[e];for(i=0,l=n.length;i<l;i++)c=n[i],c.selected=!0}}else typeof a=="undefined"&&this.firstBind?(this.firstBind=!1,this.set("unfilteredValue",this.node.value)):B.DOM.valueForNode(this.node,a);return this.updateOptionBindings()},a.prototype.nodeChange=function(){if(this.isTwoWay()){this.updateSelectBinding();return this.updateOptionBindings()}},a.prototype.updateSelectBinding=function(){var a,b;b=this.node.multiple?function(){var b,c,d,e;d=this.node.children,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.selected&&e.push(a.value);return e}.call(this):this.node.value,typeof b===Array&&b.length===1&&(b=b[0]),this.set("unfilteredValue",b);return!0},a.prototype.updateOptionBindings=function(){var a,b,c,d,e;e=this.node.children;for(c=0,d=e.length;c<d;c++)a=e[c],(b=B._data(a,"selected"))&&b.nodeChange(b.node);return!0};return a}(),B.DOM.StyleBinding=function(){function a(){this.setStyle=bf(this.setStyle,this),this.handleItemsWereRemoved=bf(this.handleItemsWereRemoved,this),this.handleItemsWereAdded=bf(this.handleItemsWereAdded,this),this.oldStyles={},a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractCollectionBinding),a.SingleStyleBinding=function(){function a(){var b,c,d;b=2<=arguments.length?bb.call(arguments,0,d=arguments.length-1):(d=0,[]),c=arguments[d++],this.parent=c,a.__super__.constructor.apply(this,b)}be(a,B.DOM.AbstractAttributeBinding),a.prototype.dataChange=function(a){return this.parent.setStyle(this.attributeName,a)};return a}(),a.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(!a)this.reapplyOldStyles();else{this.unbindCollection();if(typeof a=="string"){this.reapplyOldStyles(),k=a.split(";");for(i=0,j=k.length;i<j;i++)h=k[i],l=h.split(":"),c=l[0],b=2<=l.length?bb.call(l,1):[],this.setStyle(c,b.join(":"));return}if(a instanceof B.Hash){if(this.bindCollection(a))return a.forEach(bf(function(a,b){return this.setStyle(a,b)},this))}else if(a instanceof Object){this.reapplyOldStyles(),n=[];for(d in a){if(!bc.call(a,d))continue;e=a[d],m=this.renderContext.findKey(e),g=m[0],f=m[1],n.push(g?(this.bindSingleAttribute(d,e),this.setStyle(d,g)):this.setStyle(d,e))}return n}}},a.prototype.handleItemsWereAdded=function(a){this.setStyle(a,this.collection.get(a))},a.prototype.handleItemsWereRemoved=function(a){this.setStyle(a,"")},a.prototype.bindSingleAttribute=function(a,b){return new this.constructor.SingleStyleBinding(this.node,a,b,this.renderContext,this.renderer,this.only,this)},a.prototype.setStyle=function(a,b){if(!!a){a=K.camelize(a.trim(),!0),this.oldStyles[a]=this.node.style[a];return this.node.style[a]=b?b.trim():""}},a.prototype.reapplyOldStyles=function(){var a,b,c,d;c=this.oldStyles,d=[];for(a in c){if(!bc.call(c,a))continue;b=c[a],d.push(this.setStyle(a,b))}return d};return a}(),B.DOM.RouteBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.DOM.AbstractBinding),a.prototype.onATag=!1,a.accessor("dispatcher",function(){return this.renderContext.get("dispatcher")||B.App.get("current.dispatcher")}),a.prototype.bind=function(){this.node.nodeName.toUpperCase()==="A"&&(this.onATag=!0),a.__super__.bind.apply(this,arguments);return B.DOM.events.click(this.node,bf(function(){var a;a=this.get("filteredValue");if(a!=null)return q(a)},this))},a.prototype.dataChange=function(a){var b,c;a!=null&&(b=this.set("path",(c=this.get("dispatcher"))!=null?c.pathFromParams(a):void 0));if(this.onATag){b!=null?b=B.navigator.linkTo(b):b="#";return this.node.href=b}};return a}(),B.DOM.ViewBinding=function(){function a(){a.__super__.constructor.apply(this,arguments),this.renderer.prevent("rendered"),this.node.removeAttribute("data-view")}be(a,B.DOM.AbstractBinding),a.prototype.dataChange=function(a){var b;if(a!=null){a.isView?(this.view=a,this.view.set("node",this.node),this.view.set("context",this.renderContext)):this.view=new a({node:this.node,context:this.renderContext,parentView:(b=this.renderContext.findKey("isView"))!=null?b[1]:void 0}),B.data(this.node,"view",this.view),this.view.on("ready",bf(function(){var a,b,c;typeof (a=this.view).awakeFromHTML=="function"&&a.awakeFromHTML(this.node),typeof (b=this.view).viewWillAppear=="function"&&b.viewWillAppear(this.node),this.renderer.allowAndFire("rendered");return typeof (c=this.view).viewDidAppear=="function"?c.viewDidAppear(this.node):void 0},this));return this.die()}};return a}(),B.DOM.IteratorBinding=function(){function a(b,c,d,e,f){var g;this.iteratorName=c,this.key=d,this.context=e,this.parentRenderer=f,this.handleArrayChanged=bf(this.handleArrayChanged,this),this.handleItemsWereRemoved=bf(this.handleItemsWereRemoved,this),this.handleItemsWereAdded=bf(this.handleItemsWereAdded,this),this.nodeMap=new B.SimpleHash,this.actionMap=new B.SimpleHash,this.rendererMap=new B.SimpleHash,this.actions=[],this.prototypeNode=b.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),this.pNode=b.parentNode,g=b.nextSibling,this.siblingNode=document.createComment("end "+this.iteratorName),this.siblingNode[B.expando]=b[B.expando],B.canDeleteExpando&&delete b[B.expando],k(b.parentNode,this.siblingNode,g),this.parentRenderer.on("parsed",bf(function(){s(b);return this.bind()},this)),this.parentRenderer.prevent("rendered"),a.__super__.constructor.call(this,this.siblingNode,this.iteratorName,this.key,this.context,this.parentRenderer),this.fragment=document.createDocumentFragment()}be(a,B.DOM.AbstractCollectionBinding),a.prototype.deferEvery=50,a.prototype.currentActionNumber=0,a.prototype.queuedActionNumber=0,a.prototype.bindImmediately=!1,a.prototype.parentNode=function(){return this.siblingNode.parentNode},a.prototype.die=function(){a.__super__.die.apply(this,arguments);return this.dead=!0},a.prototype.unbindCollection=function(){if(this.collection){this.nodeMap.forEach(bf(function(a){return this.cancelExistingItem(a)},this));return a.__super__.unbindCollection.apply(this,arguments)}},a.prototype.dataChange=function(a){var b,c,d;this.collection!==a&&this.removeAll(),this.bindCollection(a);if(this.collection)if(this.collection.toArray)this.handleArrayChanged();else if(this.collection.forEach)this.collection.forEach(bf(function(a){return this.addOrInsertItem(a)},this));else{d=this.collection;for(b in d){if(!bc.call(d,b))continue;c=d[b],this.addOrInsertItem(b)}}return this.processActionQueue()},a.prototype.handleItemsWereAdded=function(){var a,b,c,d;b=1<=arguments.length?bb.call(arguments,0):[];for(c=0,d=b.length;c<d;c++)a=b[c],this.addOrInsertItem(a,{fragment:!1})},a.prototype.handleItemsWereRemoved=function(){var a,b,c,d;b=1<=arguments.length?bb.call(arguments,0):[];for(c=0,d=b.length;c<d;c++)a=b[c],this.removeItem(a)},a.prototype.handleArrayChanged=function(){var a,b,c,d,e;b=this.collection.toArray(),c=(new B.SimpleHash).merge(this.nodeMap);for(d=0,e=b.length;d<e;d++)a=b[d],this.addOrInsertItem(a,{fragment:!1}),c.unset(a);return c.forEach(bf(function(a,b){return this.removeItem(a)},this))},a.prototype.addOrInsertItem=function(a,b){var c;b==null&&(b={}),c=this.nodeMap.get(a);return c?this.insertItem(a,c):this.addItem(a,b)},a.prototype.addItem=function(a,b){var c,d,e;b==null&&(b={fragment:!0}),this.parentRenderer.prevent("rendered"),this.actionMap.get(a)!=null&&this.cancelExistingItemActions(a),e=this,b.actionNumber=this.queuedActionNumber++,c=new B.Renderer(this._nodeForItem(a),function(){e.rendererMap.unset(a);return e.insertItem(a,this.node,b)},this.renderContext.descend(a,this.iteratorName)),this.rendererMap.set(a,c),d=bf(function(){if(!this.dead)return this.parentRenderer.allowAndFire("rendered")},this),c.on("rendered",d),c.on("stopped",bf(function(){if(!this.dead){this.actions[b.actionNumber]=!1,d();return this.processActionQueue()}},this));return a},a.prototype.removeItem=function(a){var b,c;if(!this.dead&&a!=null){c=this.nodeMap.unset(a),this.cancelExistingItem(a);if(c)return(b=B.data(c,"hide"))?b.call(c):s(c)}},a.prototype.removeAll=function(){return this.nodeMap.forEach(bf(function(a){return this.removeItem(a)},this))},a.prototype.insertItem=function(a,b,c){var d;c==null&&(c={});if(!this.dead){c.actionNumber==null&&(c.actionNumber=this.queuedActionNumber++),d=this.actionMap.get(a),d>c.actionNumber?this.actions[c.actionNumber]=function(){}:(d&&this.cancelExistingItemActions(a),this.actionMap.set(a,c.actionNumber),this.actions[c.actionNumber]=function(){var d,e,f,g,h;f=B.data(b,"show"),typeof f=="function"?f.call(b,{before:this.siblingNode}):c.fragment?this.fragment.appendChild(b):k(this.parentNode(),b,this.siblingNode);if(d=b.getAttribute("data-additem")){h=this.renderer.context.findKey(d),g=h[0],e=h[1];return e!=null?typeof e[d]=="function"?e[d](a,b):void 0:void 0}},this.actions[c.actionNumber].item=a);return this.processActionQueue()}},a.prototype.cancelExistingItem=function(a){this.cancelExistingItemActions(a);return this.cancelExistingItemRender(a)},a.prototype.cancelExistingItemActions=function(a){var b;b=this.actionMap.get(a),b!=null&&b>=this.currentActionNumber&&(this.actions[b]=!1);return this.actionMap.unset(a)},a.prototype.cancelExistingItemRender=function(a){var b;b=this.rendererMap.get(a),b&&(b.stop(),s(b.node));return this.rendererMap.unset(a)},a.prototype.processActionQueue=function(){if(!this.dead&&!this.actionQueueTimeout)return this.actionQueueTimeout=t(bf(function(){var a,b;if(!this.dead){delete this.actionQueueTimeout,b=new Date;while((a=this.actions[this.currentActionNumber])!=null){delete this.actions[this.currentActionNumber],this.actionMap.unset(a.item),a&&a.call(this),this.currentActionNumber++;if(this.deferEvery&&new Date-b>this.deferEvery)return this.processActionQueue()}this.fragment&&this.rendererMap.length===0&&this.fragment.hasChildNodes()&&(k(this.parentNode(),this.fragment,this.siblingNode),this.fragment=document.createDocumentFragment());if(this.currentActionNumber===this.queuedActionNumber)return this.parentRenderer.allowAndFire("rendered")}},this))},a.prototype._nodeForItem=function(a){var b;b=this.prototypeNode.cloneNode(!0),this.nodeMap.set(a,b);return b};return a}(),F=function(a){return function(b){if(typeof b!="undefined")return a.apply(this,arguments)}},J=B.Filters={get:F(function(a,b){return a.get!=null?a.get(b):a[b]}),equals:F(function(a,b){return a===b}),not:function(a){return!a},truncate:F(function(a,b,c){c==null&&(c="..."),a.length>b&&(a=a.substr(0,b-c.length)+c);return a}),"default":function(a,b){return a||b},prepend:function(a,b){return b+a},append:function(a,b){return a+b},downcase:F(function(a){return a.toLowerCase()}),upcase:F(function(a){return a.toUpperCase()}),pluralize:F(function(a,b){return K.pluralize(b,a)}),join:F(function(a,b){b==null&&(b="");return a.join(b)}),sort:F(function(a){return a.sort()}),map:F(function(a,b){return a.map(function(a){return a[b]})}),has:function(a,b){if(a==null)return!1;return B.contains(a,b)},first:F(function(a){return a[0]}),meta:F(function(a,b){return a.meta.get(b)}),interpolate:function(a,b){var c,d,e;if(!!a){e={};for(c in b)d=b[c],e[c]=this.findKey(d)[0],e[c]==null&&(B.developer.warn("Warning! Undefined interpolation key "+c+" for interpolation",a),e[c]="");return B.helpers.interpolate(a,e)}},withArguments:function(){var a,b;a=arguments[0],b=2<=arguments.length?bb.call(arguments,1):[];if(!!a)return function(){var c;c=1<=arguments.length?bb.call(arguments,0):[];return a.call.apply(a,[this].concat(bb.call(b),bb.call(c)))}},routeToAction:function(a,b){var c;c=B.Dispatcher.paramsFromArgument(a),c.action=b;return c}},_=["capitalize","singularize","underscore","camelize"];for(V=0,X=_.length;V<X;V++)M=_[V],J[M]=F(K[M]);m(B,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){try{I=document.createElement("div");return delete I.test}catch(a){return B.canDeleteExpando=!1}}(),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?B.cache[a[B.expando]]:a[B.expando];return!!a&&!L(a)},data:function(a,b,c,d){var e,f,g,h,i,j;if(!!B.acceptData(a)){h=B.expando,f=typeof b=="string",e=B.cache,g=a[B.expando];if((!g||d&&g&&e[g]&&!e[g][h])&&f&&c===void 0)return;g||(a.nodeType!==3?a[B.expando]=g=++B.uuid:g=B.expando),e[g]||(e[g]={});if(typeof b=="object"||typeof b=="function")d?e[g][h]=m(e[g][h],b):e[g]=m(e[g],b);j=e[g],d&&(j[h]||(j[h]={}),j=j[h]),c!==void 0&&(j[b]=c),f?i=j[b]:i=j;return i}},removeData:function(a,b,c){var d,e,f,g,h,i;if(!!B.acceptData(a)){g=B.expando,h=a.nodeType,d=B.cache,e=a[B.expando];if(!d[e])return;if(b){i=c?d[e][g]:d[e];if(i){delete i[b];if(!L(i))return}}if(c){delete d[e][g];if(!L(d[e]))return}f=d[e][g],B.canDeleteExpando||!d.setInterval?delete d[e]:d[e]=null;if(f){d[e]={};return d[e][g]=f}return B.canDeleteExpando?delete a[B.expando]:a.removeAttribute?a.removeAttribute(B.expando):a[B.expando]=null}},_data:function(a,b,c){return B.data(a,b,c,!0)},acceptData:function(a){var b;if(a.nodeName){b=B.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),L=function(a){var b;for(b in a)return!1;return!0},N=B.mixins=new B.Object,B.Encoders={},B.Paginator=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Object),a.Range=function(){function a(a,b){this.offset=a,this.limit=b,this.reach=a+b}a.prototype.coversOffsetAndLimit=function(a,b){return a>=this.offset&&a+b<=this.reach};return a}(),a.Cache=function(){function b(a,c,d){this.offset=a,this.limit=c,this.items=d,b.__super__.constructor.apply(this,arguments),this.length=d.length}be(b,a.Range),b.prototype.itemsForOffsetAndLimit=function(a,b){var c,d,e,f;c=a-this.offset,d=c+b,c<0&&(e=Array(-c),c=0),f=this.items.slice(c,d);return e?e.concat(f):f};return b}(),a.prototype.offset=0,a.prototype.limit=10,a.prototype.totalCount=0,a.prototype.markAsLoadingOffsetAndLimit=function(a,b){return this.loadingRange=new B.Paginator.Range(a,b)},a.prototype.markAsFinishedLoading=function(){return delete this.loadingRange},a.prototype.offsetFromPageAndLimit=function(a,b){return Math.round((+a-1)*b)},a.prototype.pageFromOffsetAndLimit=function(a,b){return a/b+1},a.prototype._load=function(a,b){var c;if((c=this.loadingRange)!=null?!c.coversOffsetAndLimit(a,b):!void 0){this.markAsLoadingOffsetAndLimit(a,b);return this.loadItemsForOffsetAndLimit(a,b)}},a.prototype.toArray=function(){var a,b,c;a=this.get("cache"),c=this.get("offset"),b=this.get("limit"),(a!=null?!a.coversOffsetAndLimit(c,b):!void 0)&&this._load(c,b);return(a!=null?a.itemsForOffsetAndLimit(c,b):void 0)||[]},a.prototype.page=function(){return this.pageFromOffsetAndLimit(this.get("offset"),this.get("limit"))},a.prototype.pageCount=function(){return Math.ceil(this.get("totalCount")/this.get("limit"))},a.prototype.previousPage=function(){return this.set("page",this.get("page")-1)},a.prototype.nextPage=function(){return this.set("page",this.get("page")+1)},a.prototype.loadItemsForOffsetAndLimit=function(a,b){},a.prototype.updateCache=function(a,b,c){var d;d=new B.Paginator.Cache(a,b,c);if(this.loadingRange==null||!!d.coversOffsetAndLimit(this.loadingRange.offset,this.loadingRange.limit)){this.markAsFinishedLoading();return this.set("cache",d)}},a.accessor("toArray",a.prototype.toArray),a.accessor("offset","limit","totalCount",{get:B.Property.defaultAccessor.get,set:function(a,b){return B.Property.defaultAccessor.set.call(this,a,+b)}}),a.accessor("page",{get:a.prototype.page,set:function(a,b){b=+b,this.set("offset",this.offsetFromPageAndLimit(b,this.get("limit")));return b}}),a.accessor("pageCount",a.prototype.pageCount);return a}(),B.ModelPaginator=function(){function a(){a.__super__.constructor.apply(this,arguments)}be(a,B.Paginator),a.prototype.cachePadding=0,a.prototype.paddedOffset=function(a){a-=this.cachePadding;return a<0?0:a},a.prototype.paddedLimit=function(a){return a+this.cachePadding*2},a.prototype.loadItemsForOffsetAndLimit=function(a,b){var c,d,e,f;d=this.paramsForOffsetAndLimit(a,b),f=this.params;for(c in f)e=f[c],d[c]=e;return this.model.load(d,bf(function(a,b){if(a!=null){this.markAsFinishedLoading();return this.fire("error",a)}return this.updateCache(this.offsetFromParams(d),this.limitFromParams(d),b)},this))},a.prototype.paramsForOffsetAndLimit=function(a,b){return{offset:this.paddedOffset(a),limit:this.paddedLimit(b)}},a.prototype.offsetFromParams=function(a){return a.offset},a.prototype.limitFromParams=function(a){return a.limit};return a}(),B.container=typeof exports!="undefined"&&exports!==null?(module.exports=B,global):(window.Batman=B,window),typeof define=="function"&&define("batman",[],function(){return B}),B.exportHelpers=function(a){var b,c,d,e;e=["mixin","unmixin","route","redirect","typeOf","redirect","setImmediate"];for(c=0,d=e.length;c<d;c++)b=e[c],a["$"+b]=B[b];return a},B.exportGlobals=function(){return B.exportHelpers(B.container)},B.Request.prototype.send=function(a){var b,c;b={url:this.get("url"),type:this.get("method"),dataType:this.get("type"),data:a||this.get("data"),username:this.get("username"),password:this.get("password"),headers:this.get("headers"),beforeSend:bf(function(){return this.fire("loading")},this),success:bf(function(a,b,c){this.set("status",c.status),this.set("response",a);return this.fire("success",a)},this),error:bf(function(a,b,c){this.set("status",a.status),this.set("response",a.responseText),a.request=this;return this.fire("error",a)},this),complete:bf(function(){return this.fire("loaded")},this)};if((c=this.get("method"))==="PUT"||c==="POST")this.get("formData")?(b.contentType=!1,b.processData=!1,b.data=this.constructor.objectToFormData(b.data)):b.contentType=this.get("contentType");return jQuery.ajax(b)},B.mixins.animation={show:function(a){var b,c,d,e;b=$(this),c=function(){return b.show(600)},a?((d=a.append)!=null&&d.appendChild(this),(e=a.before)!=null&&e.parentNode.insertBefore(this,a.before),b.hide(),setTimeout(c,0)):c();return this},hide:function(a){$(this).hide(600,bf(function(){var b;a&&(b=this.parentNode)!=null&&b.removeChild(this);return B.DOM.didRemoveNode(this)},this));return this}}}).call(this)